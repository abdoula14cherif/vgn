<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AfriMarket â€” Mon Profil</title>
  <!-- PWA -->
  <link rel="manifest" href="/manifest.json"/>
  <meta name="theme-color" content="#080E2A"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="apple-mobile-web-app-title" content="AfriMarket"/>
  <link rel="apple-touch-icon" href="/icons/icon-192.png"/>
  <link href="https://fonts.googleapis.com/css2?family=Clash+Display:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
  <style>
    :root{
      --blue:#1B3FE4;--blue2:#2D55FF;--red:#E83030;--orange:#FF6B1A;
      --turq:#00C2B7;--bg:#F2F5FF;--card:#FFFFFF;
      --dark:#080E2A;--gray:#8892A8;--border:#E4E9F8;--gold:#F5B731;--green:#00C271;
      --nav-h:72px;
    }
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
    html{scroll-behavior:smooth;}
    body{font-family:'Plus Jakarta Sans',sans-serif;background:var(--bg);min-height:100vh;padding-bottom:calc(var(--nav-h) + 40px + env(safe-area-inset-bottom, 0px));overflow-x:hidden;}

    /* â”€â”€ HEADER â”€â”€ */
    .header{position:sticky;top:0;z-index:100;background:linear-gradient(135deg,var(--dark) 0%,#0D1E6B 100%);padding:0 1.2rem;display:flex;align-items:center;justify-content:space-between;height:60px;box-shadow:0 4px 24px rgba(8,14,42,.35);}
    .h-back{color:rgba(255,255,255,.6);font-size:.82rem;font-weight:600;cursor:pointer;border:1px solid rgba(255,255,255,.15);padding:.35rem .8rem;border-radius:99px;transition:all .2s;text-decoration:none;}
    .h-back:hover{color:white;border-color:rgba(255,255,255,.4);}
    .h-logo{font-family:'Clash Display',sans-serif;font-size:1.4rem;font-weight:700;letter-spacing:-1px;}
    .h-logo .la{color:var(--turq);}.h-logo .lm{color:var(--orange);}
    .h-right{display:flex;align-items:center;gap:.45rem;}
    .h-save{background:var(--turq);color:white;border:none;border-radius:99px;padding:.35rem .9rem;font-size:.78rem;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;opacity:0;pointer-events:none;transition:all .3s;}
    .h-save.show{opacity:1;pointer-events:all;}
    .h-save:hover{background:#00A89F;}
    .h-save:disabled{opacity:.4;cursor:not-allowed;}
    .h-dots{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15);color:white;font-size:1.3rem;font-weight:900;line-height:1;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background .2s;letter-spacing:-.5px;flex-shrink:0;}
    .h-dots:hover{background:rgba(255,255,255,.2);}

    /* â”€â”€ MENU â‹® â”€â”€ */
    .dots-menu{position:fixed;top:68px;right:1rem;z-index:500;background:white;border-radius:16px;box-shadow:0 8px 32px rgba(8,14,42,.2);border:1px solid var(--border);min-width:195px;overflow:hidden;transform:scale(.95) translateY(-8px);transform-origin:top right;opacity:0;pointer-events:none;transition:all .22s cubic-bezier(.34,1.56,.64,1);}
    .dots-menu.open{transform:scale(1) translateY(0);opacity:1;pointer-events:all;}
    .dm-item{display:flex;align-items:center;gap:.7rem;padding:.8rem 1rem;cursor:pointer;transition:background .15s;font-size:.84rem;font-weight:600;color:var(--dark);text-decoration:none;border:none;background:none;width:100%;font-family:'Plus Jakarta Sans',sans-serif;text-align:left;}
    .dm-item:not(:last-child){border-bottom:1px solid var(--border);}
    .dm-item:hover{background:var(--bg);}
    .dm-ico{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:.95rem;flex-shrink:0;}

    /* â”€â”€ HERO â”€â”€ */
    .hero{background:linear-gradient(135deg,var(--dark) 0%,#0D1E6B 55%,#1B3FE4 100%);padding:2rem 1.2rem 3.5rem;position:relative;overflow:hidden;}
    .hero::before{content:'';position:absolute;width:250px;height:250px;border-radius:50%;background:rgba(0,194,183,.08);right:-60px;top:-80px;}
    .hero::after{content:'';position:absolute;width:180px;height:180px;border-radius:50%;background:rgba(255,107,26,.06);left:-50px;bottom:-60px;}
    .hero-inner{position:relative;z-index:1;display:flex;flex-direction:column;align-items:center;text-align:center;}
    .avatar-wrap{position:relative;margin-bottom:1rem;cursor:pointer;}
    .avatar{width:90px;height:90px;border-radius:50%;background:linear-gradient(135deg,var(--turq),var(--blue2));display:flex;align-items:center;justify-content:center;font-family:'Clash Display',sans-serif;font-size:2rem;font-weight:700;color:white;border:3px solid rgba(255,255,255,.3);overflow:hidden;transition:all .3s;}
    .avatar img{width:100%;height:100%;object-fit:cover;border-radius:50%;}
    .avatar-edit{position:absolute;bottom:2px;right:2px;width:26px;height:26px;border-radius:50%;background:var(--orange);border:2px solid var(--dark);display:flex;align-items:center;justify-content:center;font-size:.7rem;}
    .avatar-uploading{position:absolute;inset:0;border-radius:50%;background:rgba(0,0,0,.5);display:none;align-items:center;justify-content:center;font-size:1.2rem;}
    .avatar-uploading.show{display:flex;}
    #avatarInput{display:none;}
    .hero-name{font-family:'Clash Display',sans-serif;font-size:1.4rem;font-weight:700;color:white;letter-spacing:-.5px;margin-bottom:.2rem;}
    .hero-email{font-size:.75rem;color:rgba(255,255,255,.45);margin-bottom:.7rem;}
    .hero-plan{display:inline-flex;align-items:center;gap:.3rem;padding:.25rem .8rem;border-radius:99px;font-size:.68rem;font-weight:700;}
    .hero-plan.free{background:rgba(255,255,255,.12);color:rgba(255,255,255,.7);border:1px solid rgba(255,255,255,.2);}
    .hero-plan.premium{background:rgba(245,183,49,.2);color:var(--gold);border:1px solid rgba(245,183,49,.35);}
    .hero-plan.elite{background:rgba(0,194,183,.2);color:var(--turq);border:1px solid rgba(0,194,183,.35);}

    /* â”€â”€ STATS â”€â”€ */
    .stats-float{position:relative;z-index:10;margin:-1.5rem 1.2rem .8rem;background:white;border-radius:18px;border:1.5px solid var(--border);box-shadow:0 8px 24px rgba(27,63,228,.1);padding:1rem;display:flex;gap:.5rem;}
    .sf{flex:1;text-align:center;padding:.4rem 0;}
    .sf+.sf{border-left:1px solid var(--border);}
    .sf-num{font-family:'Clash Display',sans-serif;font-size:1.4rem;font-weight:700;color:var(--dark);}
    .sf-lbl{font-size:.6rem;color:var(--gray);font-weight:600;margin-top:.1rem;letter-spacing:.2px;}

    /* â”€â”€ COMPLÃ‰TION â”€â”€ */
    .complet-card{margin:0 1.2rem .8rem;background:white;border-radius:16px;border:1.5px solid var(--border);padding:1rem 1.1rem;box-shadow:0 2px 10px rgba(27,63,228,.05);}
    .cc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem;}
    .cc-title{font-size:.82rem;font-weight:700;color:var(--dark);}
    .cc-pct{font-family:'Clash Display',sans-serif;font-size:.9rem;font-weight:700;color:var(--blue2);}
    .cc-bar{height:8px;background:var(--bg);border-radius:99px;overflow:hidden;border:1px solid var(--border);margin-bottom:.5rem;}
    .cc-fill{height:100%;border-radius:99px;background:linear-gradient(90deg,var(--blue),var(--turq));transition:width .8s cubic-bezier(.34,1.56,.64,1);}
    .cc-fill.done{background:linear-gradient(90deg,var(--green),var(--turq));}
    .cc-dots{display:flex;gap:.4rem;flex-wrap:wrap;}
    .cc-dot{font-size:.65rem;font-weight:700;padding:.18rem .55rem;border-radius:99px;}
    .cc-dot.ok{background:rgba(0,194,113,.1);color:var(--green);border:1px solid rgba(0,194,113,.2);}
    .cc-dot.ko{background:rgba(255,107,26,.08);color:var(--orange);border:1px solid rgba(255,107,26,.15);}

    /* â”€â”€ SECTION TITLE â”€â”€ */
    .sec{padding:1.1rem 1.2rem .5rem;}
    .sec-ttl{font-family:'Clash Display',sans-serif;font-size:.95rem;font-weight:700;color:var(--dark);letter-spacing:-.3px;}

    /* â”€â”€ FORM â”€â”€ */
    .form-card{margin:0 1.2rem;background:white;border-radius:18px;border:1.5px solid var(--border);box-shadow:0 2px 10px rgba(27,63,228,.05);padding:1.2rem;display:flex;flex-direction:column;gap:.85rem;}
    .field{display:flex;flex-direction:column;gap:.3rem;}
    .field label{font-size:.72rem;font-weight:700;color:var(--dark);letter-spacing:.2px;}
    .field-wrap{position:relative;}
    .field-ico{position:absolute;left:.85rem;top:50%;transform:translateY(-50%);font-size:.9rem;pointer-events:none;}
    .field input,.field select,.field textarea{width:100%;border:1.5px solid var(--border);border-radius:12px;padding:.7rem .9rem .7rem 2.4rem;font-family:'Plus Jakarta Sans',sans-serif;font-size:.85rem;color:var(--dark);outline:none;background:var(--bg);transition:all .2s;}
    .field textarea{padding:.7rem .9rem;resize:none;min-height:80px;}
    .field input:focus,.field select:focus,.field textarea:focus{border-color:var(--blue2);background:white;box-shadow:0 0 0 3px rgba(45,85,255,.08);}
    .field input.changed,.field select.changed,.field textarea.changed{border-color:var(--orange);}
    .field-hint{font-size:.65rem;color:var(--gray);}

    /* â”€â”€ PREMIUM CARD â”€â”€ */
    .prem-card{margin:0 1.2rem;border-radius:18px;overflow:hidden;box-shadow:0 4px 20px rgba(27,63,228,.1);}
    .prem-card.free-card{background:linear-gradient(135deg,#F8F9FF,#EEF2FF);border:1.5px solid var(--border);}
    .prem-card.prem-active{background:linear-gradient(135deg,#0D1E6B,#1B3FE4);border:none;}
    .pc-inner{padding:1.2rem 1.3rem;}
    .pc-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:.8rem;}
    .pc-ico{font-size:1.8rem;}
    .pc-badge-free{background:rgba(27,63,228,.08);color:var(--blue2);border:1px solid rgba(27,63,228,.15);font-size:.65rem;font-weight:700;padding:.22rem .6rem;border-radius:99px;}
    .pc-badge-prem{background:rgba(245,183,49,.2);color:var(--gold);border:1px solid rgba(245,183,49,.3);font-size:.65rem;font-weight:700;padding:.22rem .6rem;border-radius:99px;}
    .pc-title{font-family:'Clash Display',sans-serif;font-size:1rem;font-weight:700;margin-bottom:.3rem;}
    .free-card .pc-title{color:var(--dark);}
    .prem-active .pc-title{color:white;}
    .pc-desc{font-size:.78rem;line-height:1.5;margin-bottom:1rem;}
    .free-card .pc-desc{color:var(--gray);}
    .prem-active .pc-desc{color:rgba(255,255,255,.6);}
    .pc-expires{font-size:.72rem;font-weight:600;color:var(--gold);margin-bottom:.8rem;}
    .pc-btn{width:100%;padding:.72rem;border-radius:12px;border:none;font-family:'Clash Display',sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;transition:all .2s;}
    .pc-btn-upgrade{background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;box-shadow:0 4px 14px rgba(27,63,228,.3);}
    .pc-btn-upgrade:hover{transform:translateY(-1px);}
    .pc-btn-manage{background:rgba(255,255,255,.15);color:white;border:1px solid rgba(255,255,255,.25);}
    .pc-features{display:flex;flex-direction:column;gap:.4rem;margin-bottom:1rem;}
    .pc-feat{font-size:.75rem;display:flex;align-items:center;gap:.5rem;}
    .free-card .pc-feat{color:var(--gray);}
    .prem-active .pc-feat{color:rgba(255,255,255,.75);}

    /* â”€â”€ ANNONCES GRID â”€â”€ */
    .ad-mini-card{background:white;border-radius:16px;overflow:hidden;border:1px solid var(--border);box-shadow:0 2px 10px rgba(27,63,228,.06);cursor:pointer;transition:transform .2s;}
    .ad-mini-card:hover{transform:translateY(-3px);}

    /* â”€â”€ MES SERVICES â”€â”€ */
    .services-section{margin:0 1.2rem .4rem;display:flex;flex-direction:column;gap:.6rem;}
    .service-badge-card{background:white;border-radius:16px;border:1.5px solid var(--border);padding:1rem 1.1rem;box-shadow:0 2px 10px rgba(27,63,228,.05);display:flex;align-items:center;gap:.9rem;}
    .sb-ico-wrap{width:44px;height:44px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;}
    .sb-info{flex:1;min-width:0;}
    .sb-name{font-size:.85rem;font-weight:700;color:var(--dark);margin-bottom:.15rem;}
    .sb-status{font-size:.68rem;font-weight:700;padding:.15rem .5rem;border-radius:99px;display:inline-block;}
    .sb-status.approved{background:rgba(0,194,113,.12);color:#007A46;}
    .sb-status.pending{background:rgba(245,183,49,.12);color:#8A5A00;}
    .sb-status.rejected{background:rgba(232,48,48,.1);color:var(--red);}
    .sb-btn{background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;border:none;border-radius:10px;padding:.4rem .75rem;font-size:.72rem;font-weight:700;cursor:pointer;white-space:nowrap;font-family:'Plus Jakarta Sans',sans-serif;}
    .sb-btn:disabled{opacity:.5;cursor:default;}
    .sb-pending-info{font-size:.72rem;color:var(--gray);margin-top:.15rem;}
    .empty-services{background:white;border-radius:16px;border:1.5px dashed var(--border);padding:1.2rem;text-align:center;}
    .es-ico{font-size:1.8rem;margin-bottom:.4rem;}
    .es-title{font-size:.82rem;font-weight:700;color:var(--dark);margin-bottom:.2rem;}
    .es-desc{font-size:.72rem;color:var(--gray);margin-bottom:.7rem;line-height:1.5;}
    .es-btn{background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;border:none;border-radius:10px;padding:.5rem 1rem;font-size:.78rem;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;}

    /* â”€â”€ DANGER ZONE â”€â”€ */
    .danger-card{margin:0 1.2rem;background:white;border-radius:18px;border:1.5px solid rgba(232,48,48,.15);padding:1.2rem;box-shadow:0 2px 10px rgba(232,48,48,.05);}
    .dz-ttl{font-family:'Clash Display',sans-serif;font-size:.9rem;font-weight:700;color:var(--red);margin-bottom:.9rem;}
    .dz-btn{width:100%;padding:.7rem;border-radius:12px;border:none;font-family:'Plus Jakarta Sans',sans-serif;font-size:.82rem;font-weight:700;cursor:pointer;transition:all .2s;text-align:left;display:flex;align-items:center;gap:.6rem;margin-bottom:.55rem;}
    .dz-logout{background:rgba(232,48,48,.06);color:var(--red);border:1.5px solid rgba(232,48,48,.15);}
    .dz-logout:hover{background:var(--red);color:white;}
    .dz-del{background:rgba(139,0,0,.05);color:#8B0000;border:1.5px solid rgba(139,0,0,.1);}
    .dz-del:hover{background:#8B0000;color:white;}

    /* â”€â”€ BOTTOM NAV â”€â”€ */
    .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:white;border-top:1px solid var(--border);display:flex;align-items:center;justify-content:space-around;padding:0 .5rem;padding-bottom:env(safe-area-inset-bottom,0px);box-shadow:0 -4px 20px rgba(8,14,42,.08);z-index:99;height:calc(var(--nav-h) + env(safe-area-inset-bottom,0px));}
    .nav-item{display:flex;flex-direction:column;align-items:center;gap:.18rem;padding:.4rem .6rem;border:none;background:none;cursor:pointer;border-radius:12px;transition:background .2s;min-width:52px;position:relative;}
    .nav-item:hover{background:var(--bg);}
    .nav-ico{font-size:1.25rem;line-height:1;}
    .nav-lbl{font-size:.58rem;font-weight:600;color:var(--gray);}
    .nav-item.active .nav-lbl{color:var(--blue2);font-weight:700;}
    .nav-plus-btn{width:44px;height:44px;border-radius:50%;background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;font-size:1.4rem;display:flex;align-items:center;justify-content:center;border:none;cursor:pointer;box-shadow:0 4px 14px rgba(27,63,228,.4);}

    .nav-badge{position:absolute;top:4px;right:8px;min-width:18px;height:18px;border-radius:99px;background:var(--red);color:white;font-size:.58rem;font-weight:800;display:flex;align-items:center;justify-content:center;padding:0 4px;border:2px solid white;line-height:1;animation:badgePop .3s cubic-bezier(.34,1.56,.64,1);}
    @keyframes badgePop{from{transform:scale(0)}to{transform:scale(1)}}

    /* â”€â”€ TOAST â”€â”€ */
    #toast{position:fixed;bottom:calc(var(--nav-h)+12px);left:50%;transform:translateX(-50%) translateY(20px);background:var(--dark);color:white;padding:.7rem 1.2rem;border-radius:14px;font-size:.82rem;font-weight:600;opacity:0;transition:all .35s;pointer-events:none;z-index:300;border-left:3px solid var(--turq);box-shadow:0 8px 24px rgba(8,14,42,.3);max-width:88vw;text-align:center;}
    #toast.show{opacity:1;transform:translateX(-50%) translateY(0);}

    /* â”€â”€ MODAL â”€â”€ */
    .modal-ov{position:fixed;inset:0;background:rgba(8,14,42,.55);backdrop-filter:blur(4px);z-index:200;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;}
    .modal-ov.open{opacity:1;pointer-events:all;}
    .modal{background:white;border-radius:24px 24px 0 0;width:100%;max-width:480px;padding:1.4rem 1.3rem 2.5rem;transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.56,.64,1);}
    .modal-ov.open .modal{transform:translateY(0);}
    .modal-handle{width:40px;height:4px;background:var(--border);border-radius:99px;margin:0 auto 1.2rem;}
    .modal-title{font-family:'Clash Display',sans-serif;font-size:1rem;font-weight:700;color:var(--dark);margin-bottom:.6rem;}
    .modal-desc{font-size:.8rem;color:var(--gray);line-height:1.5;margin-bottom:1.2rem;}
    .modal-btns{display:flex;gap:.6rem;}
    .mbtn{flex:1;padding:.72rem;border-radius:12px;border:none;font-family:'Clash Display',sans-serif;font-size:.85rem;font-weight:700;cursor:pointer;transition:all .2s;}
    .mbtn-cancel{background:var(--bg);color:var(--dark);border:1.5px solid var(--border);}
    .mbtn-ok{background:var(--red);color:white;}

    /* â”€â”€ SKELETON â”€â”€ */
    .skel{background:linear-gradient(90deg,#F0F4FF 25%,#E4E9F8 50%,#F0F4FF 75%);background-size:200% 100%;animation:shimmer 1.4s infinite;border-radius:8px;}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    /* â”€â”€ MODAL PAIEMENT MONETBIL â”€â”€ */
    .pay-sheet{background:white;border-radius:24px 24px 0 0;width:100%;max-width:480px;padding:1.5rem 1.3rem 2.8rem;transform:translateY(100%);transition:transform .38s cubic-bezier(.34,1.56,.64,1);overflow-y:auto;max-height:90vh;}
    .modal-ov.open .pay-sheet{transform:translateY(0);}
    .pay-title{font-family:'Clash Display',sans-serif;font-size:1.2rem;font-weight:700;color:var(--dark);margin-bottom:.25rem;}
    .pay-sub{font-size:.78rem;color:var(--gray);margin-bottom:1.2rem;line-height:1.5;}
    .plan-cards{display:flex;flex-direction:column;gap:.65rem;margin-bottom:1rem;}
    .plan-opt{border:2px solid var(--border);border-radius:14px;padding:.85rem 1rem;cursor:pointer;transition:all .2s;position:relative;}
    .plan-opt.selected{border-color:var(--blue2);background:rgba(45,85,255,.04);}
    .plan-opt-row{display:flex;align-items:center;justify-content:space-between;}
    .plan-opt-name{font-family:'Clash Display',sans-serif;font-size:.9rem;font-weight:700;color:var(--dark);}
    .plan-opt-price{font-family:'Clash Display',sans-serif;font-size:.98rem;font-weight:700;color:var(--blue2);}
    .plan-opt-desc{font-size:.7rem;color:var(--gray);margin-top:.2rem;}
    .plan-eco{position:absolute;top:-9px;right:10px;background:var(--green);color:white;font-size:.58rem;font-weight:800;padding:.15rem .55rem;border-radius:99px;}
    .plan-radio{width:18px;height:18px;border-radius:50%;border:2px solid var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s;margin-left:.6rem;}
    .plan-opt.selected .plan-radio{border-color:var(--blue2);background:var(--blue2);}
    .plan-opt.selected .plan-radio::after{content:'';width:7px;height:7px;border-radius:50%;background:white;display:block;}
    .pay-ops{display:flex;flex-wrap:wrap;gap:.35rem;margin-bottom:1rem;}
    .pay-op{background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:.28rem .6rem;font-size:.68rem;font-weight:600;color:var(--dark);}
    .pay-avantages{background:rgba(245,183,49,.05);border:1px solid rgba(245,183,49,.2);border-radius:12px;padding:.7rem .9rem;margin-bottom:1rem;}
    .pay-avantages-ttl{font-size:.74rem;font-weight:700;color:var(--dark);margin-bottom:.3rem;}
    .pay-avantages div{font-size:.7rem;color:var(--gray);line-height:1.8;}
    .pay-btn{width:100%;padding:.82rem;border-radius:14px;border:none;background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;font-family:'Clash Display',sans-serif;font-size:.95rem;font-weight:700;cursor:pointer;box-shadow:0 4px 18px rgba(27,63,228,.3);transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.5rem;}
    .pay-btn:disabled{opacity:.5;cursor:not-allowed;}
    .pay-spin{width:16px;height:16px;border:2px solid rgba(255,255,255,.3);border-top-color:white;border-radius:50%;animation:pspin .6s linear infinite;display:none;}
    .pay-btn.loading .pay-spin{display:block;}
    .pay-btn.loading .pay-lbl{display:none;}
    @keyframes pspin{to{transform:rotate(360deg)}}
    .pay-secure{text-align:center;font-size:.63rem;color:var(--gray);margin-top:.5rem;}
  </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <a class="h-back" href="dashboard.html">â† Accueil</a>
  <div class="h-logo"><span class="la">Afri</span><span class="lm">Market</span></div>
  <div class="h-right">
    <button class="h-save" id="hSaveBtn" onclick="saveProfile()">ğŸ’¾ Sauvegarder</button>
    <button class="h-dots" id="dotsBtn" onclick="toggleDots(event)">â‹®</button>
  </div>
</div>

<!-- MENU â‹® -->
<div class="dots-menu" id="dotsMenu">
  <a class="dm-item" href="parametres.html">
    <div class="dm-ico" style="background:rgba(27,63,228,.1);">âš™ï¸</div>ParamÃ¨tres
  </a>
  <button class="dm-item" onclick="shareApp();closeDots()">
    <div class="dm-ico" style="background:rgba(0,194,183,.1);">ğŸ“¤</div>Partager l'app
  </button>
  <a class="dm-item" href="https://wa.me/237689011185?text=Support AfriMarket" target="_blank">
    <div class="dm-ico" style="background:rgba(37,211,102,.1);">ğŸ’¬</div>Aide & Support
  </a>
  <button class="dm-item" onclick="closeDots();logout()" style="color:var(--red);">
    <div class="dm-ico" style="background:rgba(232,48,48,.08);">ğŸšª</div>Se dÃ©connecter
  </button>
</div>

<!-- HERO -->
<div class="hero">
  <div class="hero-inner">
    <div class="avatar-wrap" onclick="document.getElementById('avatarInput').click()">
      <div class="avatar" id="avatarEl">
        <span id="avatarInitial">?</span>
      </div>
      <div class="avatar-edit">âœï¸</div>
      <div class="avatar-uploading" id="avatarUploading">â³</div>
    </div>
    <input type="file" id="avatarInput" accept="image/*" onchange="uploadAvatar(this)"/>
    <div class="hero-name" id="heroName">Chargementâ€¦</div>
    <div class="hero-email" id="heroEmail"></div>
    <div class="hero-plan free" id="heroPlan">ğŸ†“ Compte Gratuit</div>
  </div>
</div>

<!-- STATS -->
<div class="stats-float">
  <div class="sf"><div class="sf-num" id="statAds">â€”</div><div class="sf-lbl">ANNONCES</div></div>
  <div class="sf"><div class="sf-num" id="statRefs">â€”</div><div class="sf-lbl">FILLEULS</div></div>
  <div class="sf"><div class="sf-num" id="statSolde">â€”</div><div class="sf-lbl">SOLDE F</div></div>
  <div class="sf"><div class="sf-num" id="statDays">â€”</div><div class="sf-lbl">JOURS</div></div>
</div>

<!-- COMPLÃ‰TION PROFIL -->
<div class="complet-card" id="completCard">
  <div class="cc-top">
    <div class="cc-title">âœ¨ ComplÃ©tion du profil</div>
    <div class="cc-pct" id="ccPct">0%</div>
  </div>
  <div class="cc-bar"><div class="cc-fill" id="ccFill" style="width:0%"></div></div>
  <div class="cc-dots" id="ccDots"></div>
</div>

<!-- INFOS PERSONNELLES -->
<div class="sec"><div class="sec-ttl">ğŸ‘¤ Informations personnelles</div></div>
<div class="form-card" id="formCard">

  <div class="field">
    <label>Nom complet</label>
    <div class="field-wrap">
      <span class="field-ico">ğŸ‘¤</span>
      <input type="text" id="fName" placeholder="Ton nom complet" oninput="markChanged(this)"/>
    </div>
  </div>

  <div class="field">
    <label>NumÃ©ro WhatsApp</label>
    <div class="field-wrap">
      <span class="field-ico">ğŸ’¬</span>
      <input type="tel" id="fWa" placeholder="+237 6XX XXX XXX" oninput="markChanged(this)"/>
    </div>
    <div class="field-hint">UtilisÃ© pour que les acheteurs te contactent</div>
  </div>

  <div class="field">
    <label>Pays</label>
    <div class="field-wrap">
      <span class="field-ico">ğŸŒ</span>
      <select id="fPays" onchange="markChanged(this)">
        <option value="">SÃ©lectionner ton pays</option>
        <option value="Cameroun">ğŸ‡¨ğŸ‡² Cameroun</option>
        <option value="CÃ´te d'Ivoire">ğŸ‡¨ğŸ‡® CÃ´te d'Ivoire</option>
        <option value="SÃ©nÃ©gal">ğŸ‡¸ğŸ‡³ SÃ©nÃ©gal</option>
        <option value="Mali">ğŸ‡²ğŸ‡± Mali</option>
        <option value="Burkina Faso">ğŸ‡§ğŸ‡« Burkina Faso</option>
        <option value="GuinÃ©e">ğŸ‡¬ğŸ‡³ GuinÃ©e</option>
        <option value="BÃ©nin">ğŸ‡§ğŸ‡¯ BÃ©nin</option>
        <option value="Togo">ğŸ‡¹ğŸ‡¬ Togo</option>
        <option value="Niger">ğŸ‡³ğŸ‡ª Niger</option>
        <option value="Tchad">ğŸ‡¹ğŸ‡© Tchad</option>
        <option value="Congo">ğŸ‡¨ğŸ‡¬ Congo</option>
        <option value="Gabon">ğŸ‡¬ğŸ‡¦ Gabon</option>
        <option value="France">ğŸ‡«ğŸ‡· France</option>
        <option value="Autre">ğŸŒ Autre</option>
      </select>
    </div>
  </div>

  <div class="field">
    <label>Ville</label>
    <div class="field-wrap">
      <span class="field-ico">ğŸ“</span>
      <input type="text" id="fVille" placeholder="Ex: YaoundÃ©, Doualaâ€¦" oninput="markChanged(this)"/>
    </div>
  </div>

  <div class="field">
    <label>Bio / Description (optionnel)</label>
    <div class="field-wrap">
      <textarea id="fBio" placeholder="Parle un peu de toi ou de ce que tu vendsâ€¦" oninput="markChanged(this)" style="padding-left:.9rem"></textarea>
    </div>
    <div class="field-hint">Visible sur tes annonces</div>
  </div>

  <button onclick="saveProfile()" id="saveBtn" style="width:100%;padding:.78rem;border-radius:12px;border:none;font-family:'Clash Display',sans-serif;font-size:.9rem;font-weight:700;cursor:pointer;background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;box-shadow:0 4px 14px rgba(27,63,228,.25);">
    ğŸ’¾ Sauvegarder les modifications
  </button>

</div>

<!-- STATUT PREMIUM -->
<div class="sec"><div class="sec-ttl">ğŸ‘‘ Mon abonnement</div></div>
<div class="prem-card free-card" id="premCard">
  <div class="pc-inner">
    <div class="pc-top">
      <div class="pc-ico">ğŸ†“</div>
      <div class="pc-badge-free" id="planBadge">Compte Gratuit</div>
    </div>
    <div class="pc-title" id="planTitle">Passe Ã  Premium</div>
    <div class="pc-features" id="planFeatures">
      <div class="pc-feat">ğŸ†“ 5 annonces gratuites / mois</div>
      <div class="pc-feat">âŒ Pas de mise en avant</div>
      <div class="pc-feat">âŒ Pas de badge vendeur vÃ©rifiÃ©</div>
    </div>
    <div class="pc-desc" id="planDesc">DÃ©bloque les annonces illimitÃ©es, la mise en avant et le badge vendeur dÃ¨s 2 000 FCFA/mois.</div>
    <button class="pc-btn pc-btn-upgrade" id="planBtn" onclick="openPayModal()">
      ğŸ‘‘ Passer Premium â€” Mobile Money
    </button>
  </div>
</div>

<!-- MES ANNONCES -->
<div class="sec"><div class="sec-ttl">ğŸ“‹ Mes annonces publiÃ©es</div></div>
<div style="padding:0 1.2rem;margin-bottom:.4rem;">
  <div id="myAdsGrid" style="display:grid;grid-template-columns:1fr 1fr;gap:.75rem;">
    <div class="skel" style="height:130px;border-radius:16px;"></div>
    <div class="skel" style="height:130px;border-radius:16px;"></div>
  </div>
  <div id="myAdsEmpty" style="display:none;text-align:center;padding:1.8rem 1rem;background:white;border-radius:16px;border:1.5px solid var(--border);">
    <div style="font-size:2.2rem;margin-bottom:.5rem;">ğŸ“­</div>
    <div style="font-size:.85rem;font-weight:700;color:var(--dark);">Aucune annonce publiÃ©e</div>
    <div style="font-size:.75rem;color:var(--gray);margin-top:.3rem;">Publie ta premiÃ¨re annonce depuis le tableau de bord !</div>
    <button onclick="location.href='dashboard.html'" style="margin-top:.8rem;padding:.5rem 1.2rem;background:linear-gradient(135deg,var(--blue),var(--blue2));color:white;border:none;border-radius:99px;font-size:.78rem;font-weight:700;cursor:pointer;font-family:'Plus Jakarta Sans',sans-serif;">ğŸ›ï¸ Publier</button>
  </div>
</div>

<!-- MES AVIS REÃ‡US -->
<div class="sec"><div class="sec-ttl">â­ Mes avis reÃ§us</div></div>
<div id="avisSection" style="margin:0 1.2rem .4rem;display:flex;flex-direction:column;gap:.6rem;">
  <div style="text-align:center;color:var(--gray);font-size:.8rem;padding:1.5rem;">â³ Chargementâ€¦</div>
</div>

<!-- MES SERVICES -->
<div class="sec"><div class="sec-ttl">ğŸ’¼ Mes services actifs</div></div>
<div class="services-section" id="servicesSection">
  <div class="empty-services">
    <div class="es-ico">ğŸ’°</div>
    <div class="es-title">Commence Ã  gagner</div>
    <div class="es-desc">Tu n'as pas encore rejoint un service.<br>Rejoins une activitÃ© et gagne de l'argent !</div>
    <button class="es-btn" onclick="location.href='gagner.html'">Voir les opportunitÃ©s â†’</button>
  </div>
</div>

<!-- SERVICE CLIENT -->
<div class="sec"><div class="sec-ttl">ğŸ§ Service client</div></div>
<div style="margin:0 1.2rem .4rem;background:white;border-radius:18px;border:1.5px solid var(--border);padding:1.2rem;box-shadow:0 2px 10px rgba(27,63,228,.05);display:flex;flex-direction:column;gap:.7rem;">
  <div style="font-size:.78rem;color:var(--gray);line-height:1.6;">Une question ? Un problÃ¨me ? Notre Ã©quipe est disponible pour t'aider ğŸ™Œ</div>

  <a href="https://wa.me/237689011185?text=Bonjour%20AfriMarket%2C%20j%27ai%20besoin%20d%27aide%20%F0%9F%91%8B" target="_blank"
     style="display:flex;align-items:center;gap:.85rem;background:rgba(0,194,113,.06);border:1.5px solid rgba(0,194,113,.2);border-radius:14px;padding:.9rem 1rem;text-decoration:none;transition:all .2s;"
     onmouseover="this.style.background='rgba(0,194,113,.12)'" onmouseout="this.style.background='rgba(0,194,113,.06)'">
    <div style="width:42px;height:42px;border-radius:12px;background:rgba(0,194,113,.12);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;">ğŸ’¬</div>
    <div>
      <div style="font-family:'Clash Display',sans-serif;font-size:.88rem;font-weight:700;color:#00A878;">WhatsApp</div>
      <div style="font-size:.72rem;color:var(--gray);margin-top:.1rem;">+237 689 011 185 Â· RÃ©ponse rapide</div>
    </div>
    <div style="margin-left:auto;font-size:.75rem;font-weight:700;color:#00A878;">â†’</div>
  </a>

  <a href="mailto:support@afrimarket.app"
     style="display:flex;align-items:center;gap:.85rem;background:rgba(27,63,228,.04);border:1.5px solid rgba(27,63,228,.12);border-radius:14px;padding:.9rem 1rem;text-decoration:none;transition:all .2s;"
     onmouseover="this.style.background='rgba(27,63,228,.09)'" onmouseout="this.style.background='rgba(27,63,228,.04)'">
    <div style="width:42px;height:42px;border-radius:12px;background:rgba(27,63,228,.08);display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;">ğŸ“§</div>
    <div>
      <div style="font-family:'Clash Display',sans-serif;font-size:.88rem;font-weight:700;color:var(--blue2);">Email</div>
      <div style="font-size:.72rem;color:var(--gray);margin-top:.1rem;">support@afrimarket.app</div>
    </div>
    <div style="margin-left:auto;font-size:.75rem;font-weight:700;color:var(--blue2);">â†’</div>
  </a>

  <a href="telecharger.html"
     style="display:flex;align-items:center;gap:.85rem;background:linear-gradient(135deg,rgba(0,194,183,.06),rgba(27,63,228,.04));border:1.5px solid rgba(0,194,183,.25);border-radius:14px;padding:.9rem 1rem;text-decoration:none;transition:all .2s;"
     onmouseover="this.style.borderColor='rgba(0,194,183,.5)'" onmouseout="this.style.borderColor='rgba(0,194,183,.25)'">
    <div style="width:42px;height:42px;border-radius:12px;background:linear-gradient(135deg,var(--turq),var(--blue2));display:flex;align-items:center;justify-content:center;font-size:1.3rem;flex-shrink:0;">ğŸ“²</div>
    <div>
      <div style="font-family:'Clash Display',sans-serif;font-size:.88rem;font-weight:700;color:var(--turq);">Installer l'application</div>
      <div style="font-size:.72rem;color:var(--gray);margin-top:.1rem;">Ajouter AfriMarket Ã  l'Ã©cran d'accueil</div>
    </div>
    <div style="margin-left:auto;font-size:.75rem;font-weight:700;color:var(--turq);">â†’</div>
  </a>
</div>

<!-- ZONE DE DANGER -->
<div class="sec"><div class="sec-ttl">âš ï¸ Zone de danger</div></div>
<div class="danger-card">
  <div class="dz-ttl">Actions irrÃ©versibles</div>
  <button class="dz-btn dz-logout" id="logoutBtn" onclick="logout()">
    ğŸšª <span>Se dÃ©connecter</span>
  </button>
  <button class="dz-btn dz-del" onclick="document.getElementById('delOv').classList.add('open')">
    ğŸ—‘ï¸ <span>Supprimer mon compte</span>
  </button>
</div>

<div style="height:1rem"></div>

<!-- BOTTOM NAV -->
<nav class="bottom-nav">
  <button class="nav-item" onclick="location.href='dashboard.html'">
    <span class="nav-ico">ğŸ </span><span class="nav-lbl">Accueil</span>
  </button>
  <button class="nav-item" id="navMessages" onclick="location.href='messages.html'">
    <span class="nav-ico">ğŸ’¬</span>
    <span class="nav-lbl">Messages</span>
  </button>
  <div class="nav-item">
    <button class="nav-plus-btn" onclick="location.href='dashboard.html'">â•</button>
    <span class="nav-lbl" style="color:var(--blue2);font-weight:700">Publier</span>
  </div>
  <button class="nav-item" onclick="location.href='gagner.html'">
    <span class="nav-ico">ğŸ’°</span><span class="nav-lbl">Gagner</span>
  </button>
  <button class="nav-item active">
    <span class="nav-ico">ğŸ‘¤</span>
    <span class="nav-lbl" style="color:var(--blue2);font-weight:700">Profil</span>
  </button>
</nav>

<!-- MODAL SUPPRESSION -->
<div class="modal-ov" id="delOv" onclick="if(event.target===this)document.getElementById('delOv').classList.remove('open')">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-handle"></div>
    <div class="modal-title">ğŸ—‘ï¸ Supprimer ton compte ?</div>
    <div class="modal-desc">Cette action est <strong>irrÃ©versible</strong>. Toutes tes annonces, ton solde et tes donnÃ©es seront dÃ©finitivement supprimÃ©s.</div>
    <div class="modal-btns">
      <button class="mbtn mbtn-cancel" onclick="document.getElementById('delOv').classList.remove('open')">Annuler</button>
      <button class="mbtn mbtn-ok" onclick="deleteAccount()">Supprimer</button>
    </div>
  </div>
</div>

<!-- MODAL PAIEMENT PREMIUM MONETBIL -->
<div class="modal-ov" id="payOv" onclick="if(event.target===this)closePayModal()">
  <div class="pay-sheet" onclick="event.stopPropagation()">
    <div class="modal-handle"></div>
    <div class="pay-title">ğŸ‘‘ Passer Premium</div>
    <div class="pay-sub">Paie en Mobile Money en quelques secondes, activation immÃ©diate ğŸš€</div>

    <div class="plan-cards">
      <div class="plan-opt selected" id="optMensuel" onclick="selectPlan('mensuel')">
        <div class="plan-opt-row">
          <div>
            <div class="plan-opt-name">ğŸ“… Mensuel</div>
            <div class="plan-opt-desc">AccÃ¨s Premium 30 jours</div>
          </div>
          <div style="display:flex;align-items:center;">
            <div class="plan-opt-price">2 000 FCFA</div>
            <div class="plan-radio"></div>
          </div>
        </div>
      </div>

      <div class="plan-opt" id="optAnnuel" onclick="selectPlan('annuel')">
        <div class="plan-eco">ğŸ‰ âˆ’17%</div>
        <div class="plan-opt-row">
          <div>
            <div class="plan-opt-name">ğŸ“† Annuel</div>
            <div class="plan-opt-desc">AccÃ¨s Premium 12 mois</div>
          </div>
          <div style="display:flex;align-items:center;">
            <div class="plan-opt-price">20 000 FCFA</div>
            <div class="plan-radio"></div>
          </div>
        </div>
      </div>
    </div>

    <div style="font-size:.7rem;color:var(--gray);font-weight:600;margin-bottom:.35rem;">OpÃ©rateurs acceptÃ©s :</div>
    <div class="pay-ops">
      <span class="pay-op">ğŸ“± MTN MoMo</span>
      <span class="pay-op">ğŸŸ  Orange Money</span>
      <span class="pay-op">ğŸ”µ Moov Money</span>
      <span class="pay-op">ğŸŸ¡ Wave</span>
    </div>

    <div class="pay-avantages">
      <div class="pay-avantages-ttl">âœ¨ Ce que tu dÃ©bloques</div>
      <div>âœ… Annonces illimitÃ©es</div>
      <div>âœ… Mise en avant prioritaire</div>
      <div>âœ… Badge vendeur vÃ©rifiÃ© ğŸ‘‘</div>
      <div>âœ… Statistiques avancÃ©es</div>
    </div>

    <button class="pay-btn" id="payBtn" onclick="lancerPaiement()">
      <div class="pay-spin"></div>
      <span class="pay-lbl">ğŸ’³ Payer 2 000 FCFA</span>
    </button>
    <div class="pay-secure">ğŸ”’ Paiement sÃ©curisÃ© par Monetbil Â· Aucune carte bancaire requise</div>
    <div style="text-align:center;margin-top:.8rem;">
      <button onclick="closePayModal()" style="background:none;border:none;color:var(--gray);font-size:.78rem;cursor:pointer;">Fermer âœ•</button>
    </div>
  </div>
</div>

<div id="toast"></div>

<!-- Script Monetbil -->
<script type="text/javascript" src="https://fr.monetbil.com/widget/v2/monetbil.min.js"></script>

<script>
'use strict';

/* â”€â”€ helpers â”€â”€ */
function escHtml(s) {
  return String(s || '').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

var _sb = supabase.createClient(
  'https://elgbvitijyjriozvzqpf.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVsZ2J2aXRpanlqcmlvenZ6cXBmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEzODczNDcsImV4cCI6MjA4Njk2MzM0N30.7juarApMsBUf4b2n8ObuWYl2hMHahQC-qwjORjCTkIM'
);

var U = null, P = null, hasChanges = false;

/* â”€â”€ CONFIG MONETBIL â”€â”€ */
var MONETBIL_KEY    = 'xNWoLFAokADNyFO6xwgvv8eWXdjriILZ';
var MONETBIL_NOTIFY = 'https://elgbvitijyjriozvzqpf.supabase.co/functions/v1/monetbil-notify';
var PLANS = {
  mensuel: { amount: 2000,  label: '2 000',  months: 1,  dbPlan: 'premium' },
  annuel:  { amount: 20000, label: '20 000', months: 12, dbPlan: 'premium_annual' }
};
var _selectedPlan = 'mensuel';

function openPayModal() {
  if (P && P.is_premium) { showToast('ğŸ‘‘ Ton compte est dÃ©jÃ  Premium !', 'info'); return; }
  selectPlan('mensuel');
  document.getElementById('payOv').classList.add('open');
}
function closePayModal() { document.getElementById('payOv').classList.remove('open'); }

function selectPlan(key) {
  _selectedPlan = key;
  document.getElementById('optMensuel').classList.toggle('selected', key === 'mensuel');
  document.getElementById('optAnnuel').classList.toggle('selected', key === 'annuel');
  document.querySelector('#payBtn .pay-lbl').textContent = 'ğŸ’³ Payer ' + PLANS[key].label + ' FCFA';
}

async function lancerPaiement() {
  if (!U) { showToast('Connecte-toi pour payer', 'warning'); return; }
  var plan = PLANS[_selectedPlan];
  var ref  = 'AM_' + Date.now() + '_' + U.id.slice(0, 8);
  var btn  = document.getElementById('payBtn');
  btn.disabled = true; btn.classList.add('loading');
  try {
    await _sb.from('payment_requests').insert([{
      user_id: U.id, plan: plan.dbPlan, amount: plan.amount,
      payment_ref: ref, status: 'pending', created_at: new Date().toISOString()
    }]);
    closePayModal();
    if (typeof monetbil !== 'undefined') {
      monetbil.launch({
        service: MONETBIL_KEY, amount: plan.amount, currency: 'XAF', locale: 'fr',
        phone: (P && P.whatsapp) ? P.whatsapp.replace(/\D/g,'') : '',
        item_ref: U.id, payment_ref: ref,
        notify_url: MONETBIL_NOTIFY, return_url: window.location.href,
        onComplete: function(data) {
          if (data && data.status === 'success') {
            showToast('ğŸ‰ Paiement confirmÃ© ! Activation en coursâ€¦', 'success');
            setTimeout(async function() {
              var fr = await _sb.from('profiles').select('*').eq('id', U.id).maybeSingle();
              if (fr.data) { P = Object.assign({}, P, fr.data); updateHero(); updatePremiumCard(); }
              if (P.is_premium) showToast('ğŸ‘‘ Premium activÃ© ! Bienvenue !', 'success');
            }, 3500);
          } else { showToast('Paiement annulÃ© ou Ã©chouÃ©', 'warning'); }
        }
      });
    } else {
      var p = new URLSearchParams({
        amount: plan.amount, currency: 'XAF', locale: 'fr',
        item_ref: U.id, payment_ref: ref,
        notify_url: MONETBIL_NOTIFY, return_url: window.location.href
      });
      window.location.href = 'https://www.monetbil.com/widget/v2.1/' + MONETBIL_KEY + '?' + p.toString();
    }
  } catch(err) {
    showToast('Erreur : ' + (err.message || 'Inconnue'), 'error');
  } finally {
    btn.disabled = false; btn.classList.remove('loading');
  }
}

/* â”€â”€ INIT â”€â”€ */
(async function() {
  try {
    var res = await _sb.auth.getSession();
    var session = res.data && res.data.session;
    if (!session) { location.href = 'index.html'; return; }
    U = session.user;
  } catch(e) { showToast('Erreur connexion : ' + e.message, 'error'); return; }

  var meta = U.user_metadata || {};
  P = {
    full_name : meta.full_name || meta.name || U.email.split('@')[0],
    email     : U.email,
    avatar_url: meta.avatar_url || ''
  };
  fillForm(); updateHero();

  try {
    var pr = await _sb.from('profiles').select('*').eq('id', U.id).maybeSingle();
    if (pr.error) throw pr.error;
    if (pr.data) {
      P = Object.assign({}, P, pr.data);
    } else {
      var newProf = { id: U.id, full_name: meta.full_name || meta.name || U.email.split('@')[0], email: U.email, created_at: new Date().toISOString() };
      var ins = await _sb.from('profiles').upsert(newProf, { onConflict: 'id' }).select().single();
      if (ins.data) P = Object.assign({}, P, ins.data);
    }
  } catch(e) { console.warn('Profile fetch error:', e.message); }

  fillForm(); updateHero(); updateCompletion(); updatePremiumCard();
  loadStats(); loadMyAds(); loadMyAvis(U.id); loadUnreadMessages(); loadMyServices(); setupRealtime();
})();

/* â”€â”€ REMPLIR LE FORMULAIRE â”€â”€ */
function fillForm() {
  if (!P) return;
  document.getElementById('fName').value  = P.full_name || '';
  document.getElementById('fWa').value    = P.whatsapp  || '';
  document.getElementById('fPays').value  = P.pays      || '';
  document.getElementById('fVille').value = P.ville     || '';
  document.getElementById('fBio').value   = P.bio       || '';
}

/* â”€â”€ HERO â”€â”€ */
function updateHero() {
  var name = P.full_name || (U && U.email ? U.email.split('@')[0] : 'Utilisateur');
  document.getElementById('heroName').textContent  = name;
  document.getElementById('heroEmail').textContent = (U && U.email) || '';
  var avEl = document.getElementById('avatarEl');
  if (P.avatar_url && P.avatar_url.startsWith('http')) {
    avEl.innerHTML = '<img src="' + escHtml(P.avatar_url) + '" alt="avatar" onerror="this.style.display=\'none\'"/>';
  } else {
    avEl.innerHTML = '<span id="avatarInitial">' + escHtml((name[0] || '?').toUpperCase()) + '</span>';
  }
  var planEl = document.getElementById('heroPlan');
  if (P.is_premium) {
    planEl.className  = 'hero-plan ' + (P.plan === 'elite' ? 'elite' : 'premium');
    planEl.textContent = P.plan === 'elite' ? 'âš¡ Compte Elite' : 'ğŸ‘‘ Compte Premium';
  } else {
    planEl.className  = 'hero-plan free';
    planEl.textContent = 'ğŸ†“ Compte Gratuit';
  }
}

/* â”€â”€ COMPLÃ‰TION â”€â”€ */
function updateCompletion() {
  var checks = [
    { ok: !!(P.full_name),  label: 'Nom' },
    { ok: !!(P.whatsapp),   label: 'WhatsApp' },
    { ok: !!(P.ville),      label: 'Ville' },
    { ok: !!(P.avatar_url && P.avatar_url.startsWith('http')), label: 'Photo' },
    { ok: !!(P.pays),       label: 'Pays' },
    { ok: !!(P.bio),        label: 'Bio' }
  ];
  var done = checks.filter(function(c){ return c.ok; }).length;
  var pct  = Math.round(done / checks.length * 100);
  document.getElementById('ccPct').textContent = pct + '%';
  var fill = document.getElementById('ccFill');
  fill.style.width = pct + '%';
  if (pct >= 100) fill.classList.add('done');
  document.getElementById('ccDots').innerHTML = checks.map(function(c){
    return '<span class="cc-dot ' + (c.ok ? 'ok' : 'ko') + '">' + (c.ok ? 'âœ…' : 'âŒ') + ' ' + escHtml(c.label) + '</span>';
  }).join('');
}

/* â”€â”€ PREMIUM CARD â”€â”€ */
function updatePremiumCard() {
  var card  = document.getElementById('premCard');
  var badge = document.getElementById('planBadge');
  var title = document.getElementById('planTitle');
  var feats = document.getElementById('planFeatures');
  var desc  = document.getElementById('planDesc');
  var btn   = document.getElementById('planBtn');
  if (P.is_premium) {
    card.className  = 'prem-card prem-active';
    badge.className = 'pc-badge-prem';
    badge.textContent = P.plan === 'elite' ? 'âš¡ Elite' : 'ğŸ‘‘ Premium';
    title.textContent = P.plan === 'elite' ? 'Compte Elite Actif' : 'Compte Premium Actif';
    feats.innerHTML =
      '<div class="pc-feat">âœ… Annonces illimitÃ©es</div>' +
      '<div class="pc-feat">âœ… Mise en avant prioritaire</div>' +
      '<div class="pc-feat">âœ… Badge vendeur vÃ©rifiÃ©</div>' +
      '<div class="pc-feat">âœ… Statistiques avancÃ©es</div>';
    var exp = P.plan_expires
      ? new Date(P.plan_expires).toLocaleDateString('fr-FR', { day:'2-digit', month:'long', year:'numeric' })
      : 'â€”';
    desc.innerHTML = '<div class="pc-expires">â° Expire le ' + escHtml(exp) + '</div>';
    btn.className   = 'pc-btn pc-btn-manage';
    btn.textContent = 'âš™ï¸ GÃ©rer mon abonnement';
    btn.onclick     = function(){ showToast('Gestion abonnement disponible bientÃ´t', 'info'); };
    card.querySelector('.pc-top').children[0].textContent = 'ğŸ‘‘';
  }
}

/* â”€â”€ STATS â”€â”€ */
async function loadStats() {
  try {
    var adsRes = await _sb.from('annonces').select('id', { count:'exact', head:true }).eq('user_id', U.id);
    var refCode = P.ref_code || U.id.substring(0, 8);
    var refsRes = await _sb.from('profiles').select('id', { count:'exact', head:true }).eq('referred_by', refCode);
    var earnRes = await _sb.from('referral_earnings').select('amount, status').eq('user_id', U.id);
    var solde = 0;
    if (earnRes.data) solde = earnRes.data.filter(function(e){ return e.status === 'available'; }).reduce(function(s,e){ return s + (e.amount||0); }, 0);
    var days = P.created_at ? Math.floor((Date.now() - new Date(P.created_at).getTime()) / 86400000) : 0;
    document.getElementById('statAds').textContent   = adsRes.count || 0;
    document.getElementById('statRefs').textContent  = refsRes.count || 0;
    document.getElementById('statSolde').textContent = solde.toLocaleString('fr-FR');
    document.getElementById('statDays').textContent  = days;
  } catch(e) { console.warn('loadStats:', e); }
}

/* â”€â”€ MES ANNONCES â”€â”€ */
async function loadMyAds() {
  try {
    var res = await _sb.from('annonces')
      .select('id, titre, prix, categorie, ville, image_url, created_at')
      .eq('user_id', U.id).order('created_at', { ascending: false }).limit(20);
    var grid  = document.getElementById('myAdsGrid');
    var empty = document.getElementById('myAdsEmpty');
    if (!res.data || res.data.length === 0) { grid.style.display = 'none'; empty.style.display = 'block'; return; }
    var EMAP = { immobilier:'ğŸ ', vehicules:'ğŸš—', electronique:'ğŸ“±', mode:'ğŸ‘—', services:'ğŸ› ï¸', emploi:'ğŸ’¼', alimentation:'ğŸ¥˜', autres:'ğŸ“¦' };
    grid.style.display = 'grid'; empty.style.display = 'none';
    grid.innerHTML = res.data.map(function(ad) {
      var em   = EMAP[ad.categorie] || 'ğŸ“¦';
      var prix = ad.prix ? Number(ad.prix).toLocaleString('fr-FR') + ' FCFA' : 'Prix libre';
      var imgHtml = ad.image_url
        ? '<img id="ami_' + ad.id + '" src="' + escHtml(ad.image_url) + '" alt="" style="width:100%;height:95px;object-fit:cover;" loading="lazy">'
        : '<div style="width:100%;height:95px;background:linear-gradient(135deg,#E8EEFF,#F0F4FF);display:flex;align-items:center;justify-content:center;font-size:1.8rem;">' + em + '</div>';
      return '<div class="ad-mini-card">' + imgHtml +
        '<div style="padding:.5rem .65rem .6rem;">' +
          '<div style="font-size:.76rem;font-weight:700;color:var(--dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">' + escHtml(ad.titre || 'Sans titre') + '</div>' +
          '<div style="font-family:\'Clash Display\',sans-serif;font-size:.8rem;font-weight:700;color:var(--blue2);margin-top:1px;">' + escHtml(prix) + '</div>' +
          '<div style="display:flex;justify-content:space-between;align-items:center;margin-top:.35rem;">' +
            '<span style="font-size:.6rem;color:var(--gray);">ğŸ“ ' + escHtml(ad.ville || 'â€”') + '</span>' +
            '<button onclick="event.stopPropagation();deleteAd(\'' + ad.id + '\')" style="font-size:.6rem;color:var(--red);background:rgba(232,48,48,.08);border:none;border-radius:6px;padding:.12rem .45rem;cursor:pointer;font-weight:700;">ğŸ—‘ï¸</button>' +
          '</div>' +
        '</div></div>';
    }).join('');
  } catch(e) { console.warn('loadMyAds:', e); }
}

async function deleteAd(id) {
  if (!confirm('Supprimer cette annonce ?')) return;
  try {
    var res = await _sb.from('annonces').delete().eq('id', id).eq('user_id', U.id);
    if (res.error) throw res.error;
    showToast('Annonce supprimÃ©e âœ…', 'success'); loadMyAds(); loadStats();
  } catch(e) { showToast('Erreur : ' + e.message, 'error'); }
}

/* â”€â”€ MES AVIS â”€â”€ */
async function loadMyAvis(uid) {
  try {
    var res = await _sb.from('avis').select('note, commentaire, created_at, reviewer_id').eq('seller_id', uid).order('created_at', { ascending: false }).limit(20);
    var sec = document.getElementById('avisSection');
    if (!res.data || !res.data.length) {
      sec.innerHTML = '<div style="background:white;border-radius:16px;border:1.5px solid var(--border);padding:1.2rem;text-align:center"><div style="font-size:2rem;margin-bottom:.4rem">ğŸŒŸ</div><div style="font-size:.8rem;color:var(--gray)">Aucun avis pour l\'instant.<br>Les acheteurs pourront te noter aprÃ¨s un Ã©change.</div></div>';
      return;
    }
    var reviewerIds = res.data.map(function(a){ return a.reviewer_id; }).filter(Boolean);
    var nameMap = {};
    if (reviewerIds.length) {
      var prRes = await _sb.from('profiles').select('id, full_name').in('id', reviewerIds);
      if (prRes.data) prRes.data.forEach(function(p){ nameMap[p.id] = p.full_name || 'Anonyme'; });
    }
    var avg    = (res.data.reduce(function(s,a){ return s + a.note; }, 0) / res.data.length).toFixed(1);
    var filled = Math.round(parseFloat(avg));
    var stars  = 'â­'.repeat(filled) + 'â˜†'.repeat(Math.max(0, 5 - filled));
    var barsHtml = [5,4,3,2,1].map(function(n) {
      var cnt = res.data.filter(function(a){ return a.note === n; }).length;
      var pct = Math.round(cnt / res.data.length * 100);
      return '<div style="display:flex;align-items:center;gap:.4rem;margin-bottom:.25rem"><span style="font-size:.62rem;color:var(--gray);width:12px">' + n + '</span><div style="flex:1;height:5px;background:var(--bg);border-radius:99px;overflow:hidden"><div style="height:100%;width:' + pct + '%;background:var(--gold);border-radius:99px"></div></div><span style="font-size:.6rem;color:var(--gray);width:20px;text-align:right">' + cnt + '</span></div>';
    }).join('');
    var cardsHtml = res.data.slice(0, 5).map(function(a) {
      var name = nameMap[a.reviewer_id] || 'Anonyme';
      var init = (name[0] || '?').toUpperCase();
      var d    = new Date(a.created_at).toLocaleDateString('fr-FR', { day:'2-digit', month:'long', year:'numeric' });
      var s2   = 'â­'.repeat(a.note) + 'â˜†'.repeat(Math.max(0, 5 - a.note));
      var cmt  = a.commentaire ? '<div style="font-size:.76rem;color:var(--dark);line-height:1.5;background:var(--bg);border-radius:10px;padding:.5rem .7rem">"' + escHtml(a.commentaire) + '"</div>' : '';
      return '<div style="background:white;border-radius:14px;border:1.5px solid var(--border);padding:.9rem 1rem;"><div style="display:flex;align-items:center;gap:.6rem;margin-bottom:.5rem"><div style="width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,var(--turq),var(--blue2));display:flex;align-items:center;justify-content:center;font-size:.75rem;font-weight:700;color:white;">' + escHtml(init) + '</div><div><div style="font-size:.78rem;font-weight:700;color:var(--dark)">' + escHtml(name) + '</div><div style="font-size:.62rem;color:var(--gray)">' + escHtml(d) + '</div></div><div style="margin-left:auto;font-size:.85rem">' + s2 + '</div></div>' + cmt + '</div>';
    }).join('');
    sec.innerHTML = '<div style="background:white;border-radius:16px;border:1.5px solid var(--border);padding:1.1rem;display:flex;align-items:center;gap:1rem;"><div style="text-align:center;flex-shrink:0"><div style="font-family:\'Clash Display\',sans-serif;font-size:2.5rem;font-weight:700;color:var(--dark);line-height:1">' + avg + '</div><div style="font-size:1rem;margin:.2rem 0">' + stars + '</div><div style="font-size:.65rem;color:var(--gray)">' + res.data.length + ' avis</div></div><div style="flex:1">' + barsHtml + '</div></div>' + cardsHtml;
  } catch(e) { console.warn('loadMyAvis:', e); }
}

/* â”€â”€ BADGE MESSAGES â”€â”€ */
async function loadUnreadMessages() {
  if (!U) return;
  try {
    var res = await _sb.from('messages').select('id', { count:'exact', head:true }).eq('receiver_id', U.id).eq('read', false);
    var count = 0;
    if (!res.error) { count = res.count || 0; }
    else { var r2 = await _sb.from('messages').select('id', { count:'exact', head:true }).eq('receiver_id', U.id).eq('lu', false); if (!r2.error) count = r2.count || 0; }
    updateMessageBadge(count);
  } catch(e) { console.warn('loadUnreadMessages:', e); }
}
function updateMessageBadge(count) {
  var el = document.getElementById('navMessages'), ex = el.querySelector('.nav-badge');
  if (ex) ex.remove();
  if (count > 0) { var b = document.createElement('span'); b.className = 'nav-badge'; b.textContent = count > 99 ? '99+' : String(count); el.appendChild(b); }
}

/* â”€â”€ MARQUER CHANGEMENTS â”€â”€ */
function markChanged(el) {
  el.classList.add('changed'); hasChanges = true;
  document.getElementById('hSaveBtn').classList.add('show');
}

/* â”€â”€ UPLOAD AVATAR â”€â”€ */
async function uploadAvatar(input) {
  var file = input.files[0]; if (!file) return;
  if (file.size > 3 * 1024 * 1024) { showToast('Image trop grande (max 3 Mo)', 'warning'); return; }
  var reader = new FileReader();
  reader.onload = function(e) { document.getElementById('avatarEl').innerHTML = '<img src="' + e.target.result + '" alt="avatar" style="width:100%;height:100%;object-fit:cover;"/>'; };
  reader.readAsDataURL(file);
  document.getElementById('avatarUploading').classList.add('show');
  try {
    var ext = (file.name.split('.').pop() || 'jpg').toLowerCase().replace('jpeg','jpg');
    var path = 'avatars/' + U.id + '_' + Date.now() + '.' + ext;
    var upRes = await _sb.storage.from('avatars').upload(path, file, { upsert: true, contentType: file.type });
    if (upRes.error) { showToast('Photo affichÃ©e localement uniquement (storage indisponible)', 'warning'); return; }
    var pubData  = _sb.storage.from('avatars').getPublicUrl(path);
    var finalUrl = pubData.data && pubData.data.publicUrl ? pubData.data.publicUrl + '?t=' + Date.now() : null;
    if (!finalUrl) { var signed = await _sb.storage.from('avatars').createSignedUrl(path, 31536000); finalUrl = signed.data && signed.data.signedUrl ? signed.data.signedUrl : null; }
    if (!finalUrl) { showToast('Upload OK mais URL inaccessible', 'warning'); return; }
    var upsertRes = await _sb.from('profiles').upsert({ id: U.id, avatar_url: finalUrl }, { onConflict: 'id' });
    if (upsertRes.error) { showToast('Erreur sauvegarde photo : ' + upsertRes.error.message, 'error'); return; }
    P.avatar_url = finalUrl;
    document.getElementById('avatarEl').innerHTML = '<img src="' + escHtml(finalUrl) + '" alt="avatar" style="width:100%;height:100%;object-fit:cover;" onerror="this.style.display=\'none\'"/>';
    updateCompletion(); showToast('Photo de profil mise Ã  jour ! ğŸ‰', 'success');
  } catch(e) { showToast('Erreur : ' + e.message, 'error'); }
  finally { document.getElementById('avatarUploading').classList.remove('show'); input.value = ''; }
}

/* â”€â”€ SAUVEGARDER â”€â”€ */
async function saveProfile() {
  var name  = document.getElementById('fName').value.trim();
  var wa    = document.getElementById('fWa').value.trim();
  var pays  = document.getElementById('fPays').value;
  var ville = document.getElementById('fVille').value.trim();
  var bio   = document.getElementById('fBio').value.trim();
  if (!name) { showToast('Le nom est obligatoire', 'warning'); return; }
  var btn = document.getElementById('saveBtn'), hBtn = document.getElementById('hSaveBtn');
  btn.disabled = true; btn.textContent = 'â³ Sauvegardeâ€¦'; hBtn.disabled = true; hBtn.textContent = 'â³â€¦';
  try {
    var payload = { id: U.id, full_name: name, whatsapp: wa, pays: pays, ville: ville, bio: bio, updated_at: new Date().toISOString() };
    if (P.avatar_url) payload.avatar_url = P.avatar_url;
    var res = await _sb.from('profiles').upsert(payload, { onConflict: 'id' });
    if (res.error) throw res.error;
    P = Object.assign({}, P, { full_name: name, whatsapp: wa, pays: pays, ville: ville, bio: bio });
    document.querySelectorAll('.changed').forEach(function(el){ el.classList.remove('changed'); });
    hasChanges = false; hBtn.classList.remove('show');
    updateHero(); updateCompletion(); showToast('Profil sauvegardÃ© âœ…', 'success');
  } catch(e) { showToast('Erreur : ' + (e.message || 'Inconnue'), 'error'); }
  finally { btn.disabled = false; btn.textContent = 'ğŸ’¾ Sauvegarder les modifications'; hBtn.disabled = false; hBtn.textContent = 'ğŸ’¾ Sauvegarder'; }
}

/* â”€â”€ DÃ‰CONNEXION â”€â”€ */
async function logout() { try { await _sb.auth.signOut(); } catch(e) {} location.href = 'index.html'; }

/* â”€â”€ SUPPRESSION COMPTE â”€â”€ */
async function deleteAccount() {
  showToast('Suppression en coursâ€¦', 'info');
  try {
    await _sb.from('annonces').delete().eq('user_id', U.id);
    await _sb.from('profiles').delete().eq('id', U.id);
    await _sb.auth.signOut();
    location.href = 'index.html';
  } catch(e) { showToast('Erreur : ' + e.message, 'error'); }
}

/* â”€â”€ REALTIME â”€â”€ */
function setupRealtime() {
  _sb.channel('profile-changes-' + U.id)
    .on('postgres_changes', { event:'UPDATE', schema:'public', table:'profiles', filter:'id=eq.' + U.id }, async function() {
      var fresh = await _sb.from('profiles').select('*').eq('id', U.id).maybeSingle();
      if (fresh.data) { P = Object.assign({}, P, fresh.data); updateHero(); updatePremiumCard(); updateCompletion(); loadStats(); showToast(P.is_premium ? 'ğŸ‘‘ Premium activÃ© !' : 'ğŸ”’ Plan mis Ã  jour', 'info'); }
    }).subscribe();

  _sb.channel('notifs-' + U.id)
    .on('postgres_changes', { event:'INSERT', schema:'public', table:'notifications', filter:'user_id=eq.' + U.id }, function(payload) {
      var n = payload.new; showToast((n.icon || 'ğŸ””') + ' ' + (n.title || 'Nouvelle notification'), 'info');
      if (n.title && (n.title.indexOf('Premium') !== -1 || n.title.indexOf('Retrait') !== -1)) {
        setTimeout(async function() { var fresh = await _sb.from('profiles').select('*').eq('id', U.id).maybeSingle(); if (fresh.data) { P = Object.assign({}, P, fresh.data); updateHero(); updatePremiumCard(); } }, 1000);
      }
    }).subscribe();

  _sb.channel('messages-' + U.id)
    .on('postgres_changes', { event:'INSERT', schema:'public', table:'messages', filter:'receiver_id=eq.' + U.id }, function() { loadUnreadMessages(); }).subscribe();

  setInterval(async function() {
    try {
      var fresh = await _sb.from('profiles').select('is_premium, plan, plan_expires, avatar_url').eq('id', U.id).maybeSingle();
      if (fresh.data && (fresh.data.is_premium !== P.is_premium || fresh.data.plan !== P.plan)) { P = Object.assign({}, P, fresh.data); updateHero(); updatePremiumCard(); showToast('Compte mis Ã  jour', 'info'); }
      loadUnreadMessages();
    } catch(e) {}
  }, 30000);
}

/* â”€â”€ MENU â‹® â”€â”€ */
function toggleDots(e) { e.stopPropagation(); document.getElementById('dotsMenu').classList.toggle('open'); }
function closeDots() { document.getElementById('dotsMenu').classList.remove('open'); }
document.addEventListener('click', function(e) {
  var m = document.getElementById('dotsMenu'), b = document.getElementById('dotsBtn');
  if (m && !m.contains(e.target) && e.target !== b) m.classList.remove('open');
});

function shareApp() {
  var url = 'https://afrimarket2.vercel.app';
  if (navigator.share) { navigator.share({ title: 'AfriMarket', text: 'ğŸ›’ La marketplace africaine !', url: url }).catch(function(){}); }
  else if (navigator.clipboard) { navigator.clipboard.writeText(url).then(function(){ showToast('Lien copiÃ© ! ğŸ“‹', 'success'); }).catch(function(){}); }
}

/* â”€â”€ TOAST â”€â”€ */
var _tt;
function showToast(msg, type) {
  type = type || 'success';
  var ic  = { success:'âœ…', error:'âŒ', warning:'âš ï¸', info:'â„¹ï¸' };
  var col = { success:'var(--turq)', error:'var(--red)', warning:'var(--orange)', info:'var(--blue2)' };
  var el  = document.getElementById('toast');
  el.textContent = (ic[type] || '') + ' ' + msg;
  el.className   = 'show';
  el.style.borderLeftColor = col[type] || 'var(--blue2)';
  clearTimeout(_tt); _tt = setTimeout(function(){ el.className = ''; }, 4000);
}

/* â”€â”€ MES SERVICES â”€â”€ */
async function loadMyServices() {
  if (!U) return;
  var container = document.getElementById('servicesSection');
  if (!container) return;
  try {
    var res = await _sb.from('service_registrations').select('*').eq('user_id', U.id).order('created_at', { ascending: false });
    if (res.error) throw res.error;
    var records = res.data || [];
    if (!records.length) return;
    var info = {
      "gagner-chasseur":    { label: "Chasseur de Vendeurs",    icon: "ğŸ¯", color: "#E8960A" },
      "gagner-verificateur":{ label: "VÃ©rificateur CertifiÃ©",   icon: "ğŸ•µï¸", color: "#00A8A0" },
      "gagner-negociateur": { label: "NÃ©gociateur Pro",         icon: "ğŸ—£ï¸", color: "#D4561A" },
      "gagner-livreur":     { label: "Livreur IndÃ©pendant",     icon: "ğŸ“¦", color: "#009958" },
      "gagner-formateur":   { label: "Formateur CertifiÃ©",      icon: "ğŸ“", color: "#1B3FE4" },
      "gagner-courtier":    { label: "Courtier Import-Export",  icon: "ğŸŒ", color: "#8B2FD4" },
      "gagner-encheres":    { label: "EnchÃ¨res InversÃ©es",      icon: "ğŸ°", color: "#C42020" }
    };
    var html = records.map(function(r) {
      var s = info[r.service] || { label: r.service, icon: 'ğŸ“‹', color: '#888' };
      var statusLabel = { pending:'â³ En attente de validation', approved:'âœ… Actif', rejected:'âŒ Non retenu' }[r.status] || r.status;
      var actionBtn = '';
      if (r.status === 'approved')  actionBtn = '<button class="sb-btn" onclick="location.href=\'mes-missions.html?service=' + r.service + '\'">Voir mes missions â†’</button>';
      if (r.status === 'pending')   actionBtn = '<button class="sb-btn" disabled>En cours de traitement</button>';
      if (r.status === 'rejected')  actionBtn = '<button class="sb-btn" style="background:#f5f5f5;color:#888;" onclick="location.href=\'gagner.html\'">Recandidater</button>';
      return '<div class="service-badge-card">'
        + '<div class="sb-ico-wrap" style="background:' + s.color + '20;border:1.5px solid ' + s.color + '40;">' + s.icon + '</div>'
        + '<div class="sb-info"><div class="sb-name">' + s.label + '</div>'
        + '<span class="sb-status ' + r.status + '">' + statusLabel + '</span>'
        + (r.status === 'pending' ? '<div class="sb-pending-info">RÃ©ponse sous 24h â€” vÃ©rifie tes notifications</div>' : '')
        + '</div>' + actionBtn + '</div>';
    }).join('');
    container.innerHTML = html;
  } catch(e) { console.warn('loadMyServices error:', e.message); }
}
</script>
</body>
</html>
