<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>VGN ‚Äì Recharge</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{
  --g:#16A34A;--gd:#15803D;--gl:#22C55E;
  --o:#F97316;--od:#EA580C;
  --bg:#F2F4F7;--card:#ffffff;
  --txt:#0F172A;--mu:#64748B;--bd:#E2E8F0;
  --H:56px;--B:62px;
  --sat:env(safe-area-inset-top,0px);--sab:env(safe-area-inset-bottom,0px)
}
html,body{font-family:'Nunito',sans-serif;background:var(--bg);max-width:430px;margin:0 auto;overflow-x:hidden;min-height:100svh}

/* ‚îÄ‚îÄ‚îÄ TOPBAR ‚îÄ‚îÄ‚îÄ */
.topbar{
  position:fixed;top:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:430px;z-index:900;
  height:calc(var(--H) + var(--sat));
  background:linear-gradient(135deg,var(--gd) 0%,var(--gl) 100%);
  display:flex;align-items:flex-end;justify-content:space-between;
  padding:0 16px 12px;box-shadow:0 2px 16px rgba(21,128,61,.35)
}
.back-btn{width:36px;height:36px;border-radius:50%;background:rgba(255,255,255,.22);
  border:1.5px solid rgba(255,255,255,.4);display:flex;align-items:center;
  justify-content:center;font-size:1.3rem;color:#fff;text-decoration:none;
  font-weight:900;line-height:1;transition:background .2s}
.back-btn:active{background:rgba(255,255,255,.35)}
.top-title{font-size:1rem;font-weight:900;color:#fff;letter-spacing:.02em}
.top-vip{background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.35);
  color:#fff;font-size:.68rem;font-weight:800;padding:5px 12px;border-radius:20px}

/* ‚îÄ‚îÄ‚îÄ SCROLL WRAPPER ‚îÄ‚îÄ‚îÄ */
.scroll{
  padding-top:calc(var(--H) + var(--sat));
  padding-bottom:calc(var(--B) + var(--sab) + 20px);
  min-height:100svh
}

/* ‚îÄ‚îÄ‚îÄ STEP INDICATOR ‚îÄ‚îÄ‚îÄ */
.step-bar{
  display:flex;align-items:center;justify-content:center;
  gap:0;padding:14px 20px 10px;background:var(--card);
  border-bottom:1px solid var(--bd);
}
.step-item{display:flex;flex-direction:column;align-items:center;gap:3px;flex:1;position:relative}
.step-item:not(:last-child)::after{
  content:'';position:absolute;top:11px;left:calc(50% + 14px);
  width:calc(100% - 28px);height:2px;background:var(--bd)
}
.step-item.done:not(:last-child)::after{background:var(--g)}
.step-circle{
  width:24px;height:24px;border-radius:50%;
  background:var(--bd);display:flex;align-items:center;justify-content:center;
  font-size:.68rem;font-weight:900;color:var(--mu);transition:all .3s;z-index:1
}
.step-item.active .step-circle{background:var(--o);color:#fff;box-shadow:0 2px 10px rgba(249,115,22,.4)}
.step-item.done .step-circle{background:var(--g);color:#fff}
.step-lbl{font-size:.55rem;font-weight:700;color:var(--mu);text-align:center;line-height:1.3;white-space:nowrap}
.step-item.active .step-lbl{color:var(--o)}
.step-item.done .step-lbl{color:var(--g)}

/* ‚îÄ‚îÄ‚îÄ PLAN SELECTOR ‚îÄ‚îÄ‚îÄ */
.section-head{padding:16px 14px 10px;display:flex;align-items:center;gap:10px}
.sec-icon{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--g),var(--gd));
  display:flex;align-items:center;justify-content:center;font-size:1.2rem}
.sec-texts .sec-title{font-size:.95rem;font-weight:900;color:var(--txt)}
.sec-texts .sec-sub{font-size:.65rem;color:var(--mu);margin-top:1px}

.plans{display:flex;flex-direction:column;gap:8px;padding:0 12px 14px}
.p-card{
  background:var(--card);border-radius:18px;overflow:hidden;
  border:2.5px solid transparent;cursor:pointer;user-select:none;
  box-shadow:0 1px 8px rgba(0,0,0,.06);transition:all .18s
}
.p-card:active{transform:scale(.985)}
.p-card.sel{border-color:var(--g);box-shadow:0 4px 22px rgba(22,163,74,.18)}

.p-top{padding:13px 14px;display:flex;align-items:center;gap:12px}
.p-badge{width:50px;height:50px;border-radius:14px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;font-size:1.45rem}
.b1{background:linear-gradient(135deg,#3B82F6,#1D4ED8)}
.b2{background:linear-gradient(135deg,#7C3AED,#4C1D95)}
.b3{background:linear-gradient(135deg,#F97316,#C2410C)}
.b4{background:linear-gradient(135deg,#EF4444,#991B1B)}
.b5{background:linear-gradient(135deg,#EC4899,#9D174D)}
.b6{background:linear-gradient(135deg,#0D9488,#065F46)}
.b7{background:linear-gradient(135deg,#D97706,#78350F)}
.b8{background:linear-gradient(135deg,#6366F1,#3730A3)}
.b9{background:linear-gradient(135deg,#0284C7,#0C4A6E)}

.p-meta{flex:1;min-width:0}
.p-name{font-size:.88rem;font-weight:900;color:var(--txt)}
.p-desc{font-size:.63rem;color:var(--mu);margin-top:2px;line-height:1.4}
.p-right{flex-shrink:0;text-align:right}
.p-price{font-size:1rem;font-weight:900;color:var(--g)}
.p-radio{width:22px;height:22px;border-radius:50%;border:2.5px solid var(--bd);
  margin:5px 0 0 auto;display:flex;align-items:center;justify-content:center;transition:all .2s}
.p-card.sel .p-radio{background:var(--g);border-color:var(--g)}
.p-card.sel .p-radio::after{content:'‚úì';color:#fff;font-size:.75rem;font-weight:900}

/* Stats expandables */
.p-stats{display:none;grid-template-columns:repeat(3,1fr);
  border-top:1px solid #F1F5F9;padding:10px 14px;background:#F8FAFB}
.p-card.sel .p-stats{display:grid}
.ps{text-align:center}
.ps-v{font-size:.8rem;font-weight:900;color:var(--g)}
.ps-l{font-size:.57rem;color:var(--mu);font-weight:700;margin-top:1px}

/* Btn principal */
.btn-cta{
  display:block;margin:0 12px 10px;width:calc(100% - 24px);
  padding:15px;border:none;border-radius:14px;cursor:pointer;
  font-family:'Nunito',sans-serif;font-size:1rem;font-weight:900;
  color:#fff;letter-spacing:.02em;transition:transform .15s;
  background:linear-gradient(135deg,var(--o),var(--od));
  box-shadow:0 4px 18px rgba(249,115,22,.38)
}
.btn-cta:active{transform:scale(.97)}.btn-cta:disabled{opacity:.4;cursor:not-allowed;transform:none}
.btn-ghost{background:#EFF2F7;color:var(--mu);box-shadow:none;border:1.5px solid var(--bd)}

/* ‚îÄ‚îÄ‚îÄ PAGE 2 : PAIEMENT ‚îÄ‚îÄ‚îÄ */

/* Hero montant - fid√®le √† la capture */
.amount-hero{
  background:linear-gradient(160deg,#14532D 0%,#16A34A 60%,#22C55E 100%);
  padding:20px 18px 24px;position:relative;overflow:hidden
}
.amount-hero::before{
  content:'';position:absolute;top:-40px;right:-40px;
  width:150px;height:150px;border-radius:50%;
  background:rgba(255,255,255,.06);
}
.amount-hero::after{
  content:'';position:absolute;bottom:-30px;left:-20px;
  width:120px;height:120px;border-radius:50%;
  background:rgba(255,255,255,.04);
}
.ah-label{
  display:inline-block;background:var(--o);color:#fff;
  font-size:.7rem;font-weight:900;padding:5px 16px;
  border-radius:30px;margin-bottom:12px;letter-spacing:.06em;
  text-transform:uppercase;font-family:'Space Grotesk',sans-serif
}
.ah-plan-name{font-size:.78rem;color:rgba(255,255,255,.65);font-weight:700;margin-bottom:5px}
.ah-amount{
  font-size:2.8rem;font-weight:900;color:#fff;
  letter-spacing:.01em;line-height:1;
  font-family:'Space Grotesk',sans-serif
}
.ah-currency{font-size:.82rem;color:rgba(255,255,255,.5);margin-top:5px;font-weight:600}
.ah-timer{
  position:absolute;top:16px;right:16px;
  background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);
  color:#fff;font-size:.72rem;font-weight:800;padding:5px 12px;
  border-radius:20px;display:flex;align-items:center;gap:5px;
  font-family:'Space Grotesk',sans-serif
}

/* S√©lection op√©rateur */
.op-section{padding:14px 14px 6px}
.op-title{
  font-size:.82rem;font-weight:900;color:var(--txt);
  margin-bottom:12px;display:flex;align-items:center;gap:7px
}

/* ‚îÄ Carte op√©rateur ‚îÄ */
.op-card{
  background:var(--card);border-radius:16px;
  border:2px solid var(--bd);margin-bottom:9px;
  cursor:pointer;user-select:none;overflow:hidden;
  transition:all .18s;box-shadow:0 1px 6px rgba(0,0,0,.05)
}
.op-card:active{transform:scale(.985)}
.op-card.sel{border-color:var(--g);box-shadow:0 3px 18px rgba(22,163,74,.16)}
.op-card.sel-orange{border-color:#FF6600;box-shadow:0 3px 18px rgba(255,102,0,.16)}
.op-card.sel-mtn{border-color:#FFCC00;box-shadow:0 3px 18px rgba(255,204,0,.2)}
.op-card.sel-bsc{border-color:#F3BA2F;box-shadow:0 3px 18px rgba(243,186,47,.2)}
.op-card.sel-sol{border-color:#9945FF;box-shadow:0 3px 18px rgba(153,69,255,.2)}

.op-head{padding:14px 14px;display:flex;align-items:center;gap:12px}
.op-logo{
  width:54px;height:54px;border-radius:14px;flex-shrink:0;
  display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative
}

/* Orange Money */
.logo-orange{background:#FF6600}
.logo-orange-inner{width:42px;height:42px;border-radius:50%;background:#fff;
  display:flex;align-items:center;justify-content:center}
.logo-orange-dot{width:28px;height:28px;border-radius:50%;background:#FF6600;
  display:flex;align-items:center;justify-content:center}
.logo-orange-star{color:#fff;font-size:1rem;font-weight:900}

/* MTN */
.logo-mtn{background:#FFCC00;flex-direction:column;gap:1px;padding:4px}
.mtn-bar1{width:36px;height:8px;background:#003087;border-radius:2px}
.mtn-text{font-size:.65rem;font-weight:900;color:#003087;letter-spacing:.02em}
.mtn-bar2{width:36px;height:4px;background:#003087;border-radius:2px}

/* BSC */
.logo-bsc{background:linear-gradient(135deg,#F3BA2F,#D68E00)}
.bsc-hex{color:#fff;font-size:1.8rem;font-weight:900;line-height:1}

/* SOL */
.logo-sol{background:linear-gradient(135deg,#9945FF,#14F195)}
.sol-circle{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.25);
  display:flex;align-items:center;justify-content:center}
.sol-inner{font-size:1.1rem;color:#fff}

.op-info{flex:1;min-width:0}
.op-tag{
  font-size:.58rem;font-weight:900;padding:2px 9px;border-radius:8px;
  display:inline-block;margin-bottom:4px;letter-spacing:.03em
}
.tag-default{background:#FFF7ED;color:#C2410C;border:1px solid #FED7AA}
.tag-crypto{background:#F3E8FF;color:#7C3AED;border:1px solid #E9D5FF}
.op-name{font-size:.9rem;font-weight:900;color:var(--txt)}
.op-sub{font-size:.63rem;color:var(--mu);margin-top:2px;line-height:1.4}
.op-radio{width:24px;height:24px;border-radius:50%;border:2.5px solid var(--bd);
  flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s}
.op-card.sel-orange .op-radio,.op-card.sel .op-radio{background:var(--g);border-color:var(--g)}
.op-card.sel-orange .op-radio::after,.op-card.sel .op-radio::after{content:'‚úì';color:#fff;font-size:.8rem;font-weight:900}

/* D√©tail paiement (expanded) */
.op-detail{display:none;padding:0 14px 14px}
.op-card[data-op="orange"].sel-orange .op-detail,
.op-card[data-op="mtn"].sel .op-detail,
.op-card[data-op="bsc"].sel .op-detail,
.op-card[data-op="sol"].sel .op-detail{display:block}

/* Box infos destinataire */
.dest-box{
  background:linear-gradient(135deg,#F0FDF4,#DCFCE7);
  border:1.5px solid #BBF7D0;border-radius:14px;
  padding:14px;margin-bottom:12px
}
.dest-label{font-size:.62rem;font-weight:800;color:var(--g);
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:8px}
.dest-num{
  font-size:1.6rem;font-weight:900;color:#14532D;
  letter-spacing:.06em;font-family:'Space Grotesk',sans-serif;margin-bottom:3px
}
.dest-name{font-size:.78rem;font-weight:800;color:#166534;display:flex;align-items:center;gap:5px}
.dest-copy-btn{
  display:flex;align-items:center;justify-content:center;gap:7px;
  width:100%;margin-top:10px;padding:9px;
  background:#fff;border:1.5px solid var(--g);border-radius:10px;
  font-family:'Nunito',sans-serif;font-size:.74rem;font-weight:800;
  color:var(--g);cursor:pointer;transition:background .15s
}
.dest-copy-btn:active{background:#F0FDF4}

/* Box adresse crypto */
.crypto-box{
  background:linear-gradient(135deg,#FAF5FF,#EDE9FE);
  border:1.5px solid #C4B5FD;border-radius:14px;
  padding:14px;margin-bottom:12px
}
.crypto-net{
  display:inline-block;font-size:.62rem;font-weight:900;
  padding:3px 10px;border-radius:8px;margin-bottom:8px;letter-spacing:.04em
}
.net-bsc{background:#F3BA2F;color:#4A2E00}
.net-sol{background:linear-gradient(135deg,#9945FF,#14F195);color:#fff}
.crypto-label{font-size:.62rem;font-weight:800;color:#5B21B6;
  text-transform:uppercase;letter-spacing:.06em;margin-bottom:6px}
.crypto-addr{
  font-size:.72rem;font-weight:700;color:#3730A3;
  font-family:'Space Grotesk',monospace;word-break:break-all;
  line-height:1.5;background:#fff;border-radius:9px;padding:10px 12px;
  border:1px solid #DDD6FE;margin-bottom:8px
}
.crypto-copy-btn{
  display:flex;align-items:center;justify-content:center;gap:7px;
  width:100%;padding:9px;background:#fff;border:1.5px solid #8B5CF6;
  border-radius:10px;font-family:'Nunito',sans-serif;font-size:.74rem;
  font-weight:800;color:#7C3AED;cursor:pointer;transition:background .15s
}
.crypto-copy-btn:active{background:#F5F3FF}
.crypto-warn{
  background:#FEF2F2;border:1px solid #FECACA;border-radius:10px;
  padding:9px 12px;font-size:.65rem;font-weight:700;
  color:#991B1B;line-height:1.6;text-align:center;margin-top:10px
}

/* Montant affich√© dans la m√©thode */
.pay-amount-hint{
  text-align:center;font-size:.74rem;font-weight:700;color:var(--mu);
  margin-bottom:12px;padding:8px;background:#F8FAFC;border-radius:9px
}
.pay-amount-hint b{color:var(--g);font-size:.85rem}

/* Champ num√©ro exp√©diteur */
.num-field{margin-top:2px}
.num-field-label{font-size:.72rem;font-weight:800;color:var(--txt);margin-bottom:7px;display:block}
.num-input-wrap{
  display:flex;align-items:center;background:var(--card);
  border:2px solid var(--bd);border-radius:13px;overflow:hidden;transition:border .2s
}
.num-input-wrap:focus-within{border-color:var(--g)}
.num-flag{
  width:56px;height:56px;display:flex;align-items:center;justify-content:center;
  font-size:1.5rem;border-right:1px solid var(--bd);flex-shrink:0;background:#F8FAFC
}
.num-inp{
  flex:1;padding:15px;border:none;outline:none;
  font-family:'Nunito',sans-serif;font-size:.95rem;font-weight:800;color:var(--txt);
  background:transparent
}
.num-inp::placeholder{color:#CBD5E1;font-weight:600}

/* ‚îÄ‚îÄ‚îÄ PAGE 3 : PREUVE ‚îÄ‚îÄ‚îÄ */
.proof-card{margin:14px 12px 0;background:var(--card);border-radius:18px;padding:16px;box-shadow:0 1px 10px rgba(0,0,0,.07)}
.proof-title{font-size:.9rem;font-weight:900;color:var(--txt);margin-bottom:14px;display:flex;align-items:center;gap:8px}
.pf{margin-bottom:12px}
.pf label{display:block;font-size:.72rem;font-weight:800;color:var(--txt);margin-bottom:6px}
.pf input,.pf textarea{
  width:100%;padding:13px 14px;border:1.5px solid var(--bd);border-radius:12px;
  font-family:'Nunito',sans-serif;font-size:.9rem;font-weight:700;color:var(--txt);
  background:#fff;outline:none;transition:border .2s
}
.pf input:focus,.pf textarea:focus{border-color:var(--g)}
.pf textarea{resize:none;height:65px}
.pf .fhint{font-size:.62rem;color:var(--mu);margin-top:5px;font-weight:600}
.alert-info{
  margin:12px 12px 14px;background:#EFF6FF;border:1px solid #BFDBFE;
  border-radius:13px;padding:12px 13px;display:flex;gap:9px;align-items:flex-start
}
.ai-ico{font-size:1.1rem;flex-shrink:0}
.ai-txt{font-size:.69rem;color:#1E40AF;font-weight:700;line-height:1.55}

/* ‚îÄ‚îÄ‚îÄ PAGE 4 : SUCC√àS ‚îÄ‚îÄ‚îÄ */
.success-page{padding:44px 20px 20px;text-align:center}
.suc-emoji{font-size:5.5rem;display:block;margin-bottom:18px;animation:pop .6s cubic-bezier(.34,1.56,.64,1)}
@keyframes pop{from{transform:scale(.2);opacity:0}to{transform:scale(1);opacity:1}}
.suc-title{font-size:1.2rem;font-weight:900;color:var(--txt);margin-bottom:8px}
.suc-sub{font-size:.78rem;color:var(--mu);line-height:1.65;margin-bottom:10px}
.suc-badge{
  display:inline-block;font-size:.9rem;font-weight:900;color:var(--g);
  background:#F0FDF4;padding:11px 24px;border-radius:14px;
  margin:14px 0 22px;border:1.5px solid #BBF7D0
}
.suc-home{
  display:inline-flex;align-items:center;gap:8px;
  background:linear-gradient(135deg,var(--g),var(--gd));color:#fff;
  padding:14px 32px;border-radius:14px;font-size:.92rem;font-weight:900;
  text-decoration:none;box-shadow:0 4px 18px rgba(22,163,74,.3)
}

/* ‚îÄ‚îÄ‚îÄ HISTORIQUE ‚îÄ‚îÄ‚îÄ */
.hist-section{padding:18px 14px 8px}
.hist-title{font-size:.88rem;font-weight:900;color:var(--txt)}
.hist-list{padding:0 12px 20px;display:flex;flex-direction:column;gap:8px}
.h-item{
  background:var(--card);border-radius:14px;padding:12px 14px;
  display:flex;align-items:center;gap:10px;
  box-shadow:0 1px 6px rgba(0,0,0,.06)
}
.h-ico{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.ic-w{background:#FFF7ED}.ic-v{background:#F0FDF4}.ic-r{background:#FEF2F2}
.h-info{flex:1;min-width:0}
.h-name{font-size:.78rem;font-weight:800;color:var(--txt)}
.h-date{font-size:.62rem;color:var(--mu);margin-top:2px}
.h-right{text-align:right;flex-shrink:0}
.h-amt{font-size:.88rem;font-weight:900;color:var(--g)}
.h-stat{font-size:.6rem;font-weight:800;padding:2px 9px;border-radius:9px;margin-top:3px;display:inline-block}
.s-w{background:#FFF7ED;color:#D97706}
.s-v{background:#F0FDF4;color:var(--g)}
.s-r{background:#FEF2F2;color:#DC2626}
.empty-hist{text-align:center;padding:22px;color:var(--mu);font-size:.76rem;font-weight:700}

/* ‚îÄ‚îÄ‚îÄ BOTNAV ‚îÄ‚îÄ‚îÄ */
.botnav{
  position:fixed;bottom:0;left:50%;transform:translateX(-50%);
  width:100%;max-width:430px;
  height:calc(var(--B) + var(--sab));padding-bottom:var(--sab);
  background:#fff;border-top:1px solid var(--bd);
  display:flex;align-items:center;z-index:900;
  box-shadow:0 -3px 16px rgba(0,0,0,.07)
}
.bn{display:flex;flex-direction:column;align-items:center;gap:2px;flex:1;padding:6px 0;text-decoration:none}
.bni{font-size:1.22rem}.bnl{font-size:.57rem;font-weight:800;color:var(--mu)}

/* ‚îÄ‚îÄ‚îÄ TOAST & LOADER ‚îÄ‚îÄ‚îÄ */
.tst{
  position:fixed;top:calc(var(--H) + var(--sat) + 10px);left:50%;
  transform:translateX(-50%) translateY(-90px);
  background:#0F172A;color:#fff;padding:10px 22px;border-radius:24px;
  font-size:.77rem;font-weight:700;z-index:9999;white-space:nowrap;
  transition:transform .3s cubic-bezier(.34,1.56,.64,1);pointer-events:none;
  box-shadow:0 4px 20px rgba(0,0,0,.25)
}
.tst.show{transform:translateX(-50%) translateY(0)}
.tst.ok{background:var(--g)}.tst.err{background:#DC2626}
.ld{display:inline-block;width:11px;height:11px;border:2px solid rgba(255,255,255,.3);
  border-top-color:#fff;border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle}
.ld-g{border-color:var(--bd);border-top-color:var(--g)}
@keyframes sp{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
  <a class="back-btn" href="dashboard.html">‚Äπ</a>
  <span class="top-title">üí∞ Recharge</span>
  <div class="top-vip" id="tb-vip">‚Äî</div>
</div>

<div class="tst" id="tst"></div>

<div class="scroll">

  <!-- STEP BAR -->
  <div class="step-bar" id="step-bar">
    <div class="step-item active" id="stp1"><div class="step-circle">1</div><div class="step-lbl">Choisir<br>le plan</div></div>
    <div class="step-item" id="stp2"><div class="step-circle">2</div><div class="step-lbl">M√©thode<br>paiement</div></div>
    <div class="step-item" id="stp3"><div class="step-circle">3</div><div class="step-lbl">Envoyer<br>preuve</div></div>
    <div class="step-item" id="stp4"><div class="step-circle">4</div><div class="step-lbl">Confirmation</div></div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE 1 ‚Äî CHOISIR LE PLAN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="page1">
    <div class="section-head">
      <div class="sec-icon">üíé</div>
      <div class="sec-texts">
        <div class="sec-title">Choisissez votre plan VIP</div>
        <div class="sec-sub">S√©lectionnez le niveau que vous souhaitez activer</div>
      </div>
    </div>

    <div class="plans" id="plan-list">
      <div style="text-align:center;padding:30px"><span class="ld ld-g"></span></div>
    </div>

    <button class="btn-cta" id="btn-p1" onclick="goPage(2)" disabled>Continuer ‚Üí</button>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE 2 ‚Äî M√âTHODE DE PAIEMENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="page2" style="display:none">

    <!-- Hero montant style capture -->
    <div class="amount-hero">
      <div class="ah-timer">‚è±Ô∏è <span id="timer-display">20:00</span></div>
      <div class="ah-label">MONTANT DU PAIEMENT</div>
      <div class="ah-plan-name" id="ah-plan">‚Äî</div>
      <div class="ah-amount" id="ah-amount">‚Äî</div>
      <div class="ah-currency">Francs CFA ¬∑ XAF</div>
    </div>

    <!-- S√©lection op√©rateur -->
    <div class="op-section">
      <div class="op-title">üì≤ Veuillez s√©lectionner votre op√©rateur</div>

      <!-- ‚îÄ‚îÄ‚îÄ ORANGE MONEY ‚îÄ‚îÄ‚îÄ -->
      <div class="op-card sel-orange" id="op-orange" data-op="orange" onclick="selOp('orange')">
        <div class="op-head">
          <div class="op-logo logo-orange">
            <div class="logo-orange-inner">
              <div class="logo-orange-dot"><span class="logo-orange-star">‚ú¶</span></div>
            </div>
          </div>
          <div class="op-info">
            <div class="op-tag tag-default">PAR D√âFAUT</div>
            <div class="op-name">Orange Money</div>
            <div class="op-sub">Compatible avec les portefeuilles Orange Money ¬∑ Cameroun üá®üá≤</div>
          </div>
          <div class="op-radio"></div>
        </div>
        <div class="op-detail">
          <div class="dest-box">
            <div class="dest-label">üì± Num√©ro √† cr√©diter</div>
            <div class="dest-num">658 033 690</div>
            <div class="dest-name">üë§ Alirou Moun</div>
            <button class="dest-copy-btn" onclick="event.stopPropagation();copier('658033690','‚úÖ Num√©ro Orange copi√© !')">
              üìã Copier le num√©ro
            </button>
          </div>
          <div class="pay-amount-hint">Envoyez exactement <b id="orange-hint">‚Äî</b> √† ce num√©ro</div>
          <div class="num-field">
            <label class="num-field-label">Votre num√©ro Orange Money (exp√©diteur)</label>
            <div class="num-input-wrap">
              <div class="num-flag">üá®üá≤</div>
              <input class="num-inp" type="tel" id="num-orange" placeholder="6XX XX XX XX" inputmode="tel">
            </div>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ MTN MONEY ‚îÄ‚îÄ‚îÄ -->
      <div class="op-card" id="op-mtn" data-op="mtn" onclick="selOp('mtn')">
        <div class="op-head">
          <div class="op-logo logo-mtn">
            <div class="mtn-bar1"></div>
            <div class="mtn-text">MoMo</div>
            <div class="mtn-bar2"></div>
          </div>
          <div class="op-info">
            <div class="op-name">MTN MoMo</div>
            <div class="op-sub">Compatible avec les portefeuilles MTN Mobile Money ¬∑ Cameroun üá®üá≤</div>
          </div>
          <div class="op-radio"></div>
        </div>
        <div class="op-detail">
          <div class="dest-box">
            <div class="dest-label">üì± Num√©ro √† cr√©diter</div>
            <div class="dest-num">651 461 777</div>
            <div class="dest-name">üë§ Jean Jacques Rousseau</div>
            <button class="dest-copy-btn" onclick="event.stopPropagation();copier('651461777','‚úÖ Num√©ro MTN copi√© !')">
              üìã Copier le num√©ro
            </button>
          </div>
          <div class="pay-amount-hint">Envoyez exactement <b id="mtn-hint">‚Äî</b> √† ce num√©ro</div>
          <div class="num-field">
            <label class="num-field-label">Votre num√©ro MTN MoMo (exp√©diteur)</label>
            <div class="num-input-wrap">
              <div class="num-flag">üá®üá≤</div>
              <input class="num-inp" type="tel" id="num-mtn" placeholder="6XX XX XX XX" inputmode="tel">
            </div>
          </div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ BSC / BNB Chain ‚îÄ‚îÄ‚îÄ -->
      <div class="op-card" id="op-bsc" data-op="bsc" onclick="selOp('bsc')">
        <div class="op-head">
          <div class="op-logo logo-bsc">
            <div class="bsc-hex">‚¨°</div>
          </div>
          <div class="op-info">
            <div class="op-tag tag-crypto">BSC-1 ¬∑ BNB Chain</div>
            <div class="op-name">Crypto USDT</div>
            <div class="op-sub">BEP-20 ¬∑ Binance Smart Chain ¬∑ Frais r√©seau ultra faibles</div>
          </div>
          <div class="op-radio"></div>
        </div>
        <div class="op-detail">
          <div class="crypto-box">
            <span class="crypto-net net-bsc">‚¨° BSC-1 ¬∑ BNB Chain ¬∑ BEP-20</span>
            <div class="crypto-label">Adresse de d√©p√¥t USDT</div>
            <div class="crypto-addr">0x44C9170272c7eA2c99f5dC28d955AdFE8b4AA3CB</div>
            <button class="crypto-copy-btn" onclick="event.stopPropagation();copier('0x44C9170272c7eA2c99f5dC28d955AdFE8b4AA3CB','‚úÖ Adresse BSC copi√©e !')">
              üìã Copier l'adresse
            </button>
            <div class="crypto-warn">
              ‚ö†Ô∏è R√©seau obligatoire : <b>BSC / BEP-20 uniquement</b><br>
              Tout envoi sur un autre r√©seau entra√Æne une perte d√©finitive de fonds.
            </div>
          </div>
          <div class="pay-amount-hint">Envoyez l'√©quivalent de <b id="bsc-hint">‚Äî</b> en USDT</div>
        </div>
      </div>

      <!-- ‚îÄ‚îÄ‚îÄ SOLANA ‚îÄ‚îÄ‚îÄ -->
      <div class="op-card" id="op-sol" data-op="sol" onclick="selOp('sol')">
        <div class="op-head">
          <div class="op-logo logo-sol">
            <div class="sol-circle">
              <span class="sol-inner">‚óé</span>
            </div>
          </div>
          <div class="op-info">
            <div class="op-tag tag-crypto">SOL-1 ¬∑ Solana</div>
            <div class="op-name">Crypto USDT / SOL</div>
            <div class="op-sub">SPL Token ¬∑ R√©seau Solana ¬∑ Transactions instantan√©es</div>
          </div>
          <div class="op-radio"></div>
        </div>
        <div class="op-detail">
          <div class="crypto-box">
            <span class="crypto-net net-sol">‚óé SOL-1 ¬∑ Solana ¬∑ SPL Token</span>
            <div class="crypto-label">Adresse de d√©p√¥t USDT-SPL</div>
            <div class="crypto-addr">JBe5kePCCj3tG5RciCaNCEaJjtziycdrtKwz64Csx2VJ</div>
            <button class="crypto-copy-btn" onclick="event.stopPropagation();copier('JBe5kePCCj3tG5RciCaNCEaJjtziycdrtKwz64Csx2VJ','‚úÖ Adresse Solana copi√©e !')">
              üìã Copier l'adresse
            </button>
            <div class="crypto-warn">
              ‚ö†Ô∏è R√©seau obligatoire : <b>Solana (SPL) uniquement</b><br>
              Tout envoi sur un autre r√©seau entra√Æne une perte d√©finitive de fonds.
            </div>
          </div>
          <div class="pay-amount-hint">Envoyez l'√©quivalent de <b id="sol-hint">‚Äî</b> en USDT</div>
        </div>
      </div>

    </div><!-- /op-section -->

    <div style="display:flex;gap:8px;padding:4px 12px 20px">
      <button class="btn-cta btn-ghost" style="margin:0;flex:1;width:auto;padding:13px" onclick="goPage(1)">‚Üê Retour</button>
      <button class="btn-cta" style="margin:0;flex:2;width:auto;padding:13px" onclick="goPage(3)">J'ai pay√© ‚Üí</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE 3 ‚Äî PREUVE DE PAIEMENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="page3" style="display:none">
    <div class="proof-card">
      <div class="proof-title">üì§ Confirmer votre paiement</div>

      <div class="pf">
        <label>R√©f√©rence / ID de transaction</label>
        <input type="text" id="inp-ref" placeholder="Ex: MP241231XXXXXX ou TxHash‚Ä¶">
        <div class="fhint">Visible sur votre SMS ou re√ßu de confirmation</div>
      </div>

      <div class="pf">
        <label>Montant envoy√©</label>
        <input type="number" id="inp-montant" placeholder="0" inputmode="numeric">
        <div class="fhint">En FCFA pour Mobile Money, en USDT pour Crypto</div>
      </div>

      <div class="pf">
        <label>Note (optionnel)</label>
        <textarea id="inp-note" placeholder="Informations compl√©mentaires‚Ä¶"></textarea>
      </div>
    </div>

    <div class="alert-info">
      <span class="ai-ico">‚è±Ô∏è</span>
      <div class="ai-txt">
        Votre demande sera v√©rifi√©e par notre √©quipe sous <b>24h ouvr√©es</b>.<br>
        Votre plan <b id="note-plan">‚Äî</b> s'activera automatiquement d√®s validation et vous recevrez une notification.
      </div>
    </div>

    <div style="display:flex;gap:8px;padding:0 12px 20px">
      <button class="btn-cta btn-ghost" style="margin:0;flex:1;width:auto;padding:13px" onclick="goPage(2)">‚Üê Retour</button>
      <button class="btn-cta" id="btn-submit" style="margin:0;flex:2;width:auto;padding:13px" onclick="soumettre()">‚úÖ Envoyer</button>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PAGE 4 ‚Äî CONFIRMATION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="page4" style="display:none">
    <div class="success-page">
      <span class="suc-emoji">‚è≥</span>
      <div class="suc-title">Demande envoy√©e !</div>
      <div class="suc-sub">Votre paiement est bien re√ßu et en cours de v√©rification par notre √©quipe admin.</div>
      <div class="suc-badge" id="suc-plan">‚Äî en attente</div>
      <div class="suc-sub">Vous recevrez une notification d√®s l'activation de votre plan VIP.</div>
      <br>
      <a href="dashboard.html" class="suc-home">üè† Retour √† l'accueil</a>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HISTORIQUE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
  <div id="hist-wrap">
    <div class="hist-section"><div class="hist-title">üìã Mes demandes de recharge</div></div>
    <div class="hist-list" id="hist-list">
      <div style="text-align:center;padding:20px"><span class="ld ld-g"></span></div>
    </div>
  </div>

</div><!-- /scroll -->

<nav class="botnav">
  <a class="bn" href="dashboard.html"><span class="bni">üè†</span><span class="bnl">Accueil</span></a>
  <a class="bn" href="taches.html"><span class="bni">‚úÖ</span><span class="bnl">T√¢ches</span></a>
  <a class="bn" href="rapport.html"><span class="bni">üìä</span><span class="bnl">Rapports</span></a>
  <a class="bn" href="profil.html"><span class="bni">üë§</span><span class="bnl">Mon Compte</span></a>
</nav>

<script>
/* ‚îÄ‚îÄ‚îÄ SUPABASE ‚îÄ‚îÄ‚îÄ */
const SB=supabase.createClient(
  'https://tgrfzybemuwvhkbpuzmz.supabase.co',
  'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRncmZ6eWJlbXV3dmhrYnB1em16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDMwOTgsImV4cCI6MjA4NzY3OTA5OH0.M20AwabfyHK_btwhgCmdUUbP2IAtY4TeYbc3Ovzj7CE',
  {auth:{persistSession:true,storageKey:'vgn-auth',storage:window.localStorage}}
);

/* ‚îÄ‚îÄ‚îÄ PLANS VIP ‚îÄ‚îÄ‚îÄ */
const PLANS=[
  {n:1,label:'VIP 1',job:'Job 1',gain:70,   taches:5, depot:10500,   ico:'üíº',b:'b1'},
  {n:2,label:'VIP 2',job:'Job 2',gain:175,  taches:8, depot:42000,   ico:'üöÄ',b:'b2'},
  {n:3,label:'VIP 3',job:'Job 3',gain:560,  taches:10,depot:168000,  ico:'‚≠ê',b:'b3'},
  {n:4,label:'VIP 4',job:'Job 4',gain:1300, taches:15,depot:585000,  ico:'üíé',b:'b4'},
  {n:5,label:'VIP 5',job:'Job 5',gain:2000, taches:20,depot:1200000, ico:'üèÜ',b:'b5'},
  {n:6,label:'VIP 6',job:'Job 6',gain:3500, taches:25,depot:2625000, ico:'üëë',b:'b6'},
  {n:7,label:'VIP 7',job:'Job 7',gain:6400, taches:30,depot:5760000, ico:'üåü',b:'b7'},
  {n:8,label:'VIP 8',job:'Job 8',gain:11000,taches:35,depot:11550000,ico:'üí´',b:'b8'},
  {n:9,label:'VIP 9',job:'Job 9',gain:19000,taches:40,depot:22800000,ico:'üéØ',b:'b9'},
];

/* ‚îÄ‚îÄ‚îÄ HELPERS ‚îÄ‚îÄ‚îÄ */
const $=id=>document.getElementById(id);
const $s=(id,v)=>{const e=$(id);if(e)e.textContent=v};
const fmt=n=>Number(n||0).toLocaleString('fr-FR');
const fmtF=n=>fmt(n)+' FCFA';
const toast=(m,t='')=>{const el=$('tst');el.textContent=m;el.className='tst show'+(t?' '+t:'');setTimeout(()=>el.className='tst',3500)};

let U=null, planSel=null, opSel='orange';

/* ‚îÄ‚îÄ‚îÄ TIMER (20 min) ‚îÄ‚îÄ‚îÄ */
let timerSec=20*60, timerInt=null;
function startTimer(){
  clearInterval(timerInt);timerSec=20*60;
  timerInt=setInterval(()=>{
    if(timerSec<=0){clearInterval(timerInt);$s('timer-display','Expir√©');return}
    timerSec--;
    const m=String(Math.floor(timerSec/60)).padStart(2,'0');
    const s=String(timerSec%60).padStart(2,'0');
    $s('timer-display',m+':'+s);
  },1000);
}

/* ‚îÄ‚îÄ‚îÄ COPIER ‚îÄ‚îÄ‚îÄ */
function copier(txt,msg){
  const fb=()=>{const t=document.createElement('textarea');t.value=txt;document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);toast(msg,'ok')};
  if(navigator.clipboard) navigator.clipboard.writeText(txt).then(()=>toast(msg,'ok')).catch(fb);
  else fb();
}

/* ‚îÄ‚îÄ‚îÄ RENDU PLANS ‚îÄ‚îÄ‚îÄ */
function renderPlans(){
  $('plan-list').innerHTML=PLANS.map(p=>{
    const rev=p.gain*p.taches;
    return `<div class="p-card" id="pc${p.n}" onclick="selPlan(${p.n})">
      <div class="p-top">
        <div class="p-badge ${p.b}">${p.ico}</div>
        <div class="p-meta">
          <div class="p-name">${p.label} ‚Äî ${p.job}</div>
          <div class="p-desc">${p.taches} t√¢ches/jour ¬∑ +${fmt(p.gain)} FCFA/t√¢che ¬∑ ${fmtF(rev)}/jour</div>
        </div>
        <div class="p-right">
          <div class="p-price">${fmtF(p.depot)}</div>
          <div class="p-radio" id="rd${p.n}"></div>
        </div>
      </div>
      <div class="p-stats">
        <div class="ps"><div class="ps-v">${fmt(p.gain)} F</div><div class="ps-l">/ t√¢che</div></div>
        <div class="ps"><div class="ps-v">${fmtF(rev)}</div><div class="ps-l">/ jour</div></div>
        <div class="ps"><div class="ps-v">${fmtF(rev*30)}</div><div class="ps-l">/ mois est.</div></div>
      </div>
    </div>`;
  }).join('');
}

function selPlan(n){
  PLANS.forEach(p=>$('pc'+p.n)?.classList.remove('sel'));
  $('pc'+n)?.classList.add('sel');
  planSel=PLANS.find(p=>p.n===n);
  $('btn-p1').disabled=false;
}

/* ‚îÄ‚îÄ‚îÄ OP√âRATEUR ‚îÄ‚îÄ‚îÄ */
function selOp(op){
  opSel=op;
  // Retirer toutes les classes sel
  ['orange','mtn','bsc','sol'].forEach(k=>{
    const el=$('op-'+k);
    if(el) el.className='op-card';
  });
  // Appliquer la classe sel selon op√©rateur
  const clsMap={orange:'sel-orange',mtn:'sel',bsc:'sel',sol:'sel'};
  $('op-'+op)?.classList.add(clsMap[op]);
  // Afficher les .op-detail du bon op√©rateur
  // (g√©r√© via CSS avec data-op + sel)
}

/* ‚îÄ‚îÄ‚îÄ STEP BAR ‚îÄ‚îÄ‚îÄ */
function setStep(n){
  [1,2,3,4].forEach(i=>{
    const el=$('stp'+i);
    el.classList.remove('active','done');
    if(i<n) el.classList.add('done');
    else if(i===n) el.classList.add('active');
  });
}

/* ‚îÄ‚îÄ‚îÄ NAVIGATION PAGES ‚îÄ‚îÄ‚îÄ */
function goPage(n){
  // Validation avant passage
  if(n===2){
    if(!planSel){toast('‚ö†Ô∏è Veuillez s√©lectionner un plan','err');return}
    const amt=fmtF(planSel.depot);
    $s('ah-plan',planSel.label+' ‚Äî '+planSel.job);
    $s('ah-amount','XAF '+fmt(planSel.depot));
    // Hints montant dans chaque m√©thode
    ['orange-hint','mtn-hint','bsc-hint','sol-hint'].forEach(id=>$s(id,amt));
    startTimer();
  }
  if(n===3){
    // V√©rif num√©ro si mobile money
    if(opSel==='orange'){
      const num=($('num-orange')?.value||'').replace(/\s/g,'');
      if(num.length<8){toast('‚ö†Ô∏è Entrez votre num√©ro Orange Money exp√©diteur','err');return}
    }
    if(opSel==='mtn'){
      const num=($('num-mtn')?.value||'').replace(/\s/g,'');
      if(num.length<8){toast('‚ö†Ô∏è Entrez votre num√©ro MTN MoMo exp√©diteur','err');return}
    }
    $s('note-plan',planSel?.label||'‚Äî');
  }

  [1,2,3,4].forEach(i=>{
    const p=$('page'+i);
    if(p) p.style.display=i===n?'block':'none';
  });
  $('hist-wrap').style.display=n===4?'none':'block';
  setStep(n);
  window.scrollTo({top:0,behavior:'smooth'});
}

/* ‚îÄ‚îÄ‚îÄ SOUMETTRE ‚îÄ‚îÄ‚îÄ */
async function soumettre(){
  const ref=($('inp-ref')?.value||'').trim();
  const mont=parseFloat($('inp-montant')?.value)||0;
  const note=($('inp-note')?.value||'').trim();
  const numExp=opSel==='orange'?($('num-orange')?.value||'').trim():
                opSel==='mtn'  ?($('num-mtn')?.value||'').trim():'';

  if(!ref){toast('‚ö†Ô∏è R√©f√©rence de transaction requise','err');return}
  if(mont<=0){toast('‚ö†Ô∏è Indiquez le montant envoy√©','err');return}

  const btn=$('btn-submit');
  btn.textContent='‚è≥ Envoi en cours...';btn.disabled=true;

  try{
    const{error}=await SB.from('recharges').insert({
      user_id:         U.id,
      plan_niveau:     planSel.n,
      plan_label:      planSel.label,
      plan_depot:      planSel.depot,
      plan_gain:       planSel.gain,
      plan_taches:     planSel.taches,
      operateur:       opSel,
      num_expediteur:  numExp||null,
      ref_transaction: ref,
      montant_envoye:  mont,
      note:            note||null,
      statut:          'en_attente',
      created_at:      new Date().toISOString()
    });
    if(error) throw new Error(error.message);

    clearInterval(timerInt);
    $s('suc-plan','‚úÖ '+planSel.label+' ‚Äî En attente de validation');
    goPage(4);
    await chargerHistorique();
    toast('‚úÖ Demande envoy√©e avec succ√®s !','ok');
  }catch(err){
    toast('‚ùå '+err.message,'err');console.error(err);
  }finally{
    btn.textContent='‚úÖ Envoyer';btn.disabled=false;
  }
}

/* ‚îÄ‚îÄ‚îÄ HISTORIQUE ‚îÄ‚îÄ‚îÄ */
async function chargerHistorique(){
  const{data:h}=await SB.from('recharges')
    .select('*').eq('user_id',U.id)
    .order('created_at',{ascending:false}).limit(20);

  const list=$('hist-list');
  if(!h||!h.length){list.innerHTML='<div class="empty-hist">Aucune demande de recharge pour le moment</div>';return}

  const stl={en_attente:'En attente',valide:'Valid√© ‚úì',rejete:'Rejet√©'};
  const stc={en_attente:'s-w',valide:'s-v',rejete:'s-r'};
  const stic={en_attente:'ic-w',valide:'ic-v',rejete:'ic-r'};
  const oico={orange:'üçä',mtn:'üì±',bsc:'‚¨°',sol:'‚óé'};

  list.innerHTML=h.map(r=>{
    const st=r.statut||'en_attente';
    const d=new Date(r.created_at).toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric'});
    const opLabel={orange:'Orange Money',mtn:'MTN MoMo',bsc:'BSC-1 USDT',sol:'SOL-1 USDT'}[r.operateur]||r.operateur||'‚Äî';
    return `<div class="h-item">
      <div class="h-ico ${stic[st]}">${oico[r.operateur]||'üí∞'}</div>
      <div class="h-info">
        <div class="h-name">${r.plan_label||'‚Äî'} ¬∑ ${opLabel}</div>
        <div class="h-date">${d} ¬∑ R√©f: ${r.ref_transaction||'‚Äî'}</div>
      </div>
      <div class="h-right">
        <div class="h-amt">${fmtF(r.montant_envoye)}</div>
        <span class="h-stat ${stc[st]}">${stl[st]||st}</span>
      </div>
    </div>`;
  }).join('');
}

/* ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ */
async function init(){
  const{data:{session}}=await SB.auth.getSession();
  if(!session){window.location.href='index.html';return}
  U=session.user;
  const{data:p}=await SB.from('profiles').select('vip_niveau,solde').eq('id',U.id).single();
  $s('tb-vip',(p?.vip_niveau)||'VIP 0');
  renderPlans();
  await chargerHistorique();
}

/* Fix CSS pour op-detail visible selon s√©lection ‚Äî override via JS */
function updateOpDetailVisibility(){
  // Reset all op-detail
  document.querySelectorAll('.op-detail').forEach(el=>el.style.display='none');
  // Show only selected
  const activeCard=$('.op-card.sel-orange')||$('.op-card.sel');
  if(activeCard){
    const detail=activeCard.querySelector('.op-detail');
    if(detail) detail.style.display='block';
  }
}

// Override selOp pour g√©rer la visibility
const _selOpOrig=selOp;
window.selOp=function(op){
  opSel=op;
  ['orange','mtn','bsc','sol'].forEach(k=>{
    const el=$('op-'+k);
    if(!el) return;
    el.className='op-card';
    const detail=el.querySelector('.op-detail');
    if(detail) detail.style.display='none';
  });
  const clsMap={orange:'sel-orange',mtn:'sel',bsc:'sel',sol:'sel'};
  const selectedEl=$('op-'+op);
  if(selectedEl){
    selectedEl.classList.add(clsMap[op]);
    const detail=selectedEl.querySelector('.op-detail');
    if(detail) detail.style.display='block';
  }
};

init().then(()=>{
  // Afficher le d√©tail Orange par d√©faut
  const orangeDetail=$('#op-orange .op-detail')||$('op-orange')?.querySelector('.op-detail');
  if(orangeDetail) orangeDetail.style.display='block';
  $('op-orange').querySelector('.op-detail').style.display='block';
});
</script>
</body>
</html>
