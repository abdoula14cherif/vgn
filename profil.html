<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VGN â€“ Mon Compte</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--g:#16A34A;--gd:#15803D;--o:#F97316;--od:#EA580C;--bg:#F2F5F2;--card:#fff;--txt:#111827;--mu:#6B7280;--bd:#E5E7EB;--H:58px;--B:58px}
html{font-family:'Nunito',sans-serif;background:var(--bg)}
body{max-width:430px;margin:0 auto;background:var(--bg);overflow-x:hidden}

.topbar{position:fixed;top:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:var(--H);background:linear-gradient(135deg,var(--gd),#22C55E);display:flex;align-items:center;justify-content:space-between;padding:0 14px;z-index:999;box-shadow:0 2px 10px rgba(0,0,0,.15)}
.tl{display:flex;align-items:center;gap:8px}
.badge{width:32px;height:32px;background:var(--o);border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:1rem}
.logo{font-size:1.2rem;font-weight:900;color:#fff;letter-spacing:.07em}
.ibtn{width:32px;height:32px;border-radius:50%;background:rgba(255,255,255,.18);border:1px solid rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;font-size:.95rem;cursor:pointer}

.scroll{padding-top:var(--H);padding-bottom:calc(var(--B)+18px);min-height:100vh}

.botnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:var(--B);background:#fff;border-top:1px solid var(--bd);display:flex;align-items:center;z-index:999;box-shadow:0 -2px 10px rgba(0,0,0,.07)}
.bn{display:flex;flex-direction:column;align-items:center;gap:2px;flex:1;padding:6px 0;text-decoration:none;position:relative;cursor:pointer}
.bn.on::before{content:'';position:absolute;top:0;left:50%;transform:translateX(-50%);width:26px;height:3px;background:var(--g);border-radius:0 0 3px 3px}
.bni{font-size:1.2rem}.bnl{font-size:.57rem;font-weight:800;color:var(--mu)}.bn.on .bnl{color:var(--g)}

/* â”€â”€ HERO â”€â”€ */
.hero-profil{
  background:linear-gradient(160deg,var(--gd) 0%,#22C55E 100%);
  padding:20px 16px 38px;
  display:flex;flex-direction:column;align-items:center;
  position:relative;
}
.hero-profil::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:28px;background:var(--bg);border-radius:28px 28px 0 0}

.avatar{width:76px;height:76px;border-radius:50%;border:3px solid rgba(255,255,255,.5);background:#ccc;display:flex;align-items:center;justify-content:center;font-size:2rem;font-weight:900;color:#fff;margin-bottom:10px;overflow:hidden;position:relative;flex-shrink:0}
.avatar img{width:100%;height:100%;object-fit:cover;position:absolute;inset:0}
.avatar-edit{position:absolute;bottom:2px;right:2px;width:20px;height:20px;background:var(--o);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.6rem;cursor:pointer}

.u-phone{font-size:1rem;font-weight:900;color:#fff;margin-bottom:3px;letter-spacing:.03em}
.u-name{font-size:.75rem;color:rgba(255,255,255,.75);margin-bottom:14px}
.vip-badge{display:inline-flex;align-items:center;gap:6px;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.35);border-radius:20px;padding:4px 14px;font-size:.72rem;font-weight:800;color:#fff}

/* â”€â”€ 3 WALLETS â”€â”€ */
.wallets{display:flex;justify-content:space-around;width:100%;margin-top:16px}
.wi{display:flex;flex-direction:column;align-items:center;gap:3px;flex:1}
.wlbl{font-size:.59rem;color:rgba(255,255,255,.72);font-weight:700;text-align:center;line-height:1.3}
.wval{font-size:1.1rem;font-weight:900;color:#fff}
.wsep{width:1px;background:rgba(255,255,255,.25);align-self:stretch;margin:4px 0}

/* â”€â”€ SOLDE HIGHLIGHTS â”€â”€ */
.solde-highlight{
  margin:30px 12px 10px;
  display:grid;grid-template-columns:1fr 1fr;gap:9px;
}
.sh-card{
  background:var(--card);border-radius:16px;padding:13px 14px;
  box-shadow:0 2px 12px rgba(0,0,0,.09);position:relative;overflow:hidden;
}
.sh-card::after{content:attr(data-e);position:absolute;right:-4px;bottom:-4px;font-size:2.5rem;opacity:.08}
.sh-card.green{border-left:4px solid var(--g)}
.sh-card.orange{border-left:4px solid var(--o)}
.shl{font-size:.62rem;color:var(--mu);font-weight:700;margin-bottom:4px}
.shv{font-size:1.1rem;font-weight:900}
.shv.g{color:var(--g)}.shv.o{color:var(--o)}
.shs{font-size:.6rem;font-weight:700;margin-top:3px;color:var(--mu)}

/* â”€â”€ CODE Ã‰CHANGE â”€â”€ */
.code-bar{margin:0 12px 10px;background:linear-gradient(135deg,var(--g),var(--gd));border-radius:14px;padding:12px 16px;display:flex;align-items:center;gap:10px;box-shadow:0 4px 14px rgba(22,163,74,.25);cursor:pointer;text-decoration:none}
.code-bar span{font-size:.82rem;font-weight:800;color:#fff;flex:1}
.code-bar .arr{font-size:.9rem;color:rgba(255,255,255,.7)}

/* â”€â”€ TRÃ‰SOR â”€â”€ */
.tresor{margin:0 12px 12px;background:linear-gradient(135deg,var(--o),var(--od));border-radius:16px;padding:13px 15px;box-shadow:0 4px 14px rgba(249,115,22,.25)}
.tr-head{display:flex;align-items:center;justify-content:space-between;margin-bottom:11px}
.tr-head span{font-size:.75rem;font-weight:800;color:rgba(255,255,255,.85)}
.tr-btn{background:rgba(255,255,255,.22);border:1px solid rgba(255,255,255,.35);border-radius:20px;padding:4px 12px;font-size:.7rem;font-weight:800;color:#fff;text-decoration:none;white-space:nowrap}
.tresor-row{display:flex;gap:10px}
.ti{flex:1;background:rgba(255,255,255,.15);border-radius:10px;padding:9px 11px}
.tilbl{font-size:.6rem;color:rgba(255,255,255,.75);font-weight:700;margin-bottom:3px}
.tival{font-size:1rem;font-weight:900;color:#fff}

/* â”€â”€ STATS 3Ã—3 â”€â”€ */
.sec{padding:0 13px;margin-bottom:9px}
.sec h3{font-size:.87rem;font-weight:800;color:var(--txt)}
.stats{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:0 12px;margin-bottom:14px}
.scard{background:var(--card);border-radius:14px;padding:10px 9px;box-shadow:0 1px 6px rgba(0,0,0,.07);text-align:center}
.slbl{font-size:.59rem;color:var(--mu);font-weight:700;line-height:1.3;margin-bottom:5px}
.sval{font-size:.92rem;font-weight:900;color:var(--txt)}
.sval.g{color:var(--g)}.sval.o{color:var(--o)}

/* â”€â”€ MENU â”€â”€ */
.menu{background:var(--card);border-radius:18px;margin:0 12px 14px;box-shadow:0 1px 8px rgba(0,0,0,.07);overflow:hidden}
.mi{display:flex;align-items:center;gap:11px;padding:13px 15px;text-decoration:none;border-bottom:1px solid #F3F4F6;cursor:pointer;transition:background .15s}
.mi:last-child{border-bottom:none}
.mi:active{background:#F0FDF4}
.mic{width:36px;height:36px;border-radius:11px;display:flex;align-items:center;justify-content:center;font-size:1.1rem;flex-shrink:0}
.mitxt{flex:1}
.mtt{font-size:.8rem;font-weight:800;color:var(--txt)}
.mts{font-size:.62rem;color:var(--mu);margin-top:1px}
.marr{font-size:.75rem;color:#C4C9D4;font-weight:700}

/* â”€â”€ LOGOUT â”€â”€ */
.logout{margin:0 12px 20px;display:flex;align-items:center;justify-content:center;gap:8px;padding:13px;background:#FEE2E2;border-radius:14px;font-size:.84rem;font-weight:800;color:#DC2626;cursor:pointer;border:none;width:calc(100% - 24px);font-family:'Nunito',sans-serif;transition:background .2s}
.logout:active{background:#FECACA}

/* â”€â”€ TOAST â”€â”€ */
.tst{position:fixed;top:66px;left:50%;transform:translateX(-50%) translateY(-80px);background:#111;color:#fff;padding:8px 20px;border-radius:22px;font-size:.77rem;font-weight:700;z-index:99999;white-space:nowrap;transition:transform .3s cubic-bezier(.34,1.56,.64,1);pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.tst.show{transform:translateX(-50%) translateY(0)}.tst.err{background:#DC2626}
.ld{display:inline-block;width:10px;height:10px;border:2px solid #ccc;border-top-color:var(--g);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle}
@keyframes sp{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="topbar">
  <div class="tl"><div class="badge">ğŸŒ±</div><span class="logo">VGN</span></div>
  <div class="tl" style="gap:7px">
    <div class="ibtn" onclick="toast('ğŸ”” Aucune notification')">ğŸ””</div>
    <div class="ibtn" onclick="toast('ğŸ’¬ Support 24h/24')">ğŸ’¬</div>
  </div>
</div>
<div class="tst" id="tst"></div>

<div class="scroll">

  <!-- HERO PROFIL -->
  <div class="hero-profil">
    <div class="avatar" style="position:relative">
      <img id="av-img" src="" alt="" style="display:none">
      <span id="av-ini">VG</span>
      <div class="avatar-edit" onclick="toast('âœï¸ BientÃ´t disponible')">âœï¸</div>
    </div>
    <div class="u-phone" id="u-phone"><span class="ld"></span></div>
    <div class="u-name" id="u-name">Chargement...</div>
    <div class="vip-badge">ğŸ’ <span id="u-vip">VIP 0</span></div>
    <!-- 3 portefeuilles -->
    <div class="wallets">
      <div class="wi">
        <span class="wlbl">Portefeuille<br>revenus</span>
        <span class="wval" id="w-rev"><span class="ld"></span></span>
      </div>
      <div class="wsep"></div>
      <div class="wi">
        <span class="wlbl">Solde<br>disponible</span>
        <span class="wval" id="w-solde"><span class="ld"></span></span>
      </div>
      <div class="wsep"></div>
      <div class="wi">
        <span class="wlbl">Niveau<br>VIP</span>
        <span class="wval" id="w-vip"><span class="ld"></span></span>
      </div>
    </div>
  </div>

  <!-- SOLDE + GAINS EN GROS -->
  <div class="solde-highlight">
    <div class="sh-card green" data-e="ğŸ’°">
      <div class="shl">ğŸ’° Solde disponible</div>
      <div class="shv g" id="big-solde"><span class="ld"></span></div>
      <div class="shs" id="big-solde-sub">â€”</div>
    </div>
    <div class="sh-card orange" data-e="ğŸ“ˆ">
      <div class="shl">ğŸ“ˆ Gains totaux</div>
      <div class="shv o" id="big-gains"><span class="ld"></span></div>
      <div class="shs">Depuis le dÃ©but</div>
    </div>
    <div class="sh-card green" data-e="ğŸŒ±">
      <div class="shl">ğŸŒ± Investissement</div>
      <div class="shv g" id="big-invest"><span class="ld"></span></div>
      <div class="shs">En cours</div>
    </div>
    <div class="sh-card orange" data-e="âœ…">
      <div class="shl">âœ… TÃ¢ches du jour</div>
      <div class="shv o" id="big-tasks"><span class="ld"></span></div>
      <div class="shs">/ 3 max</div>
    </div>
  </div>

  <!-- CODE Ã‰CHANGE -->
  <a class="code-bar" href="code-echange.html">
    <span>ğŸŸï¸ &nbsp;Entrer un code d'Ã©change</span>
    <span class="arr">â€º</span>
  </a>

  <!-- TRÃ‰SOR -->
  <div class="tresor">
    <div class="tr-head">
      <span>ğŸ’° TrÃ©sor de Fonds & BÃ©nÃ©fices</span>
      <a class="tr-btn" href="transfert.html">TransfÃ©rer â†’</a>
    </div>
    <div class="tresor-row">
      <div class="ti"><div class="tilbl">TrÃ©sor de Fonds</div><div class="tival" id="t-tresor"><span class="ld"></span></div></div>
      <div class="ti"><div class="tilbl">BÃ©nÃ©fices du jour</div><div class="tival" id="t-benef"><span class="ld"></span></div></div>
    </div>
  </div>

  <!-- STATS 9 cases -->
  <div class="sec"><h3>ğŸ“Š Statistiques</h3></div>
  <div class="stats">
    <div class="scard"><div class="slbl">Gains d'hier</div><div class="sval" id="s-hier"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Gains du jour</div><div class="sval g" id="s-jour"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Gains totaux</div><div class="sval" id="s-total"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Cette semaine</div><div class="sval" id="s-sem"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Ce mois</div><div class="sval" id="s-mois"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">TÃ¢ches faites</div><div class="sval g" id="s-tok"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">TÃ¢ches restantes</div><div class="sval o" id="s-trest"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Rabais comm.</div><div class="sval" id="s-rabais"><span class="ld"></span></div></div>
    <div class="scard"><div class="slbl">Comm. parrainage</div><div class="sval" id="s-commis"><span class="ld"></span></div></div>
  </div>

  <!-- MENU -->
  <div class="menu">
    <a class="mi" href="info-personnelles.html"><div class="mic" style="background:#FEF3C7">ğŸ‘¤</div><div class="mitxt"><div class="mtt">Informations personnelles</div><div class="mts">Nom, email, tÃ©lÃ©phone</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="liste-taches.html"><div class="mic" style="background:#DCFCE7">ğŸ“‹</div><div class="mitxt"><div class="mtt">Liste des tÃ¢ches</div><div class="mts">Toutes les tÃ¢ches disponibles</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="etat-quotidien.html"><div class="mic" style="background:#DBEAFE">ğŸ“…</div><div class="mitxt"><div class="mtt">Ã‰tat quotidien</div><div class="mts">Rapport de la journÃ©e</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="rapport-equipe.html"><div class="mic" style="background:#FCE7F3">ğŸ‘¥</div><div class="mitxt"><div class="mtt">Rapport d'Ã©quipe</div><div class="mts">Suivi de vos filleuls</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="historique.html"><div class="mic" style="background:#F3E8FF">ğŸ•</div><div class="mitxt"><div class="mtt">Historique transactions</div><div class="mts">Toutes vos opÃ©rations</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="enregistrement-tresor.html"><div class="mic" style="background:#FEF3C7">ğŸ’°</div><div class="mitxt"><div class="mtt">Enregistrement TrÃ©sor</div><div class="mts">Historique des fonds</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="inviter.html"><div class="mic" style="background:#FEE2E2">ğŸ</div><div class="mitxt"><div class="mtt">Inviter des amis</div><div class="mts">Partagez et gagnez</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="aide.html"><div class="mic" style="background:#F3F4F6">ğŸ“–</div><div class="mitxt"><div class="mtt">Manuel d'aide</div><div class="mts">Guide et FAQ</div></div><span class="marr">â€º</span></a>
    <a class="mi" href="application.html"><div class="mic" style="background:#DCFCE7">ğŸ“²</div><div class="mitxt"><div class="mtt">TÃ©lÃ©charger l'application</div><div class="mts">Android & iOS</div></div><span class="marr">â€º</span></a>
  </div>

  <button class="logout" onclick="logout()">ğŸšª Se dÃ©connecter</button>

</div>

<nav class="botnav">
  <a class="bn" href="dashboard.html"><span class="bni">ğŸ </span><span class="bnl">Accueil</span></a>
  <a class="bn" href="taches.html"><span class="bni">âœ…</span><span class="bnl">TÃ¢ches</span></a>
  <a class="bn" href="rapport.html"><span class="bni">ğŸ“Š</span><span class="bnl">Rapports</span></a>
  <a class="bn on" href="profil.html"><span class="bni">ğŸ‘¤</span><span class="bnl">Mon Compte</span></a>
</nav>

<script>
const SURL='https://tgrfzybemuwvhkbpuzmz.supabase.co';
const SKEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRncmZ6eWJlbXV3dmhrYnB1em16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDMwOTgsImV4cCI6MjA4NzY3OTA5OH0.M20AwabfyHK_btwhgCmdUUbP2IAtY4TeYbc3Ovzj7CE';
const SB=supabase.createClient(SURL,SKEY);

const fmt=n=>Number(n||0).toLocaleString('fr-FR');
const fmtF=n=>fmt(n)+' FCFA';
const MAX=3;
function $s(id,v){const e=document.getElementById(id);if(e)e.textContent=v}
function toast(m,e=false){const t=document.getElementById('tst');t.textContent=m;t.className='tst show'+(e?' err':'');setTimeout(()=>t.className='tst',3500)}
async function logout(){await SB.auth.signOut();window.location.href='index.html'}

// â”€â”€ CrÃ©er ou rÃ©cupÃ©rer le profil â”€â”€
async function getOrCreateProfile(user){
  const{data:p}=await SB.from('profiles').select('*').eq('id',user.id).single();
  if(p) return p;
  // CrÃ©er le profil
  const name=user.user_metadata?.full_name||user.email?.split('@')[0]||'Investisseur';
  const code='VGN-'+Math.random().toString(36).slice(2,8).toUpperCase();
  const{data:np}=await SB.from('profiles').upsert({
    id:user.id, email:user.email||'', full_name:name,
    vip_niveau:'VIP 0', solde:0, gains_totaux:0,
    gains_jour:0, gains_hier:0, gains_semaine:0, gains_mois:0,
    investissement:0, revenu_attendu:0, taches_jour:0,
    benefices_jour:0, rabais_commission:0, commission_parrainage:0,
    code_parrainage:code,
  },{onConflict:'id'}).select().single();
  return np||{id:user.id,solde:0,gains_totaux:0,gains_jour:0,investissement:0,taches_jour:0,created_at:user.created_at};
}

// â”€â”€ Afficher toutes les donnÃ©es du profil â”€â”€
function displayProfile(p, tasksDone){
  const rest=Math.max(MAX-tasksDone,0);

  // Header wallets
  $s('w-rev',   fmtF(p.gains_totaux));
  $s('w-solde', fmtF(p.solde));
  $s('w-vip',   (p.vip_niveau||'VIP 0').replace('VIP ',''));
  $s('u-vip',   p.vip_niveau||'VIP 0');

  // Big cards solde
  $s('big-solde',  fmtF(p.solde));
  $s('big-solde-sub', p.solde>0 ? 'â†‘ Disponible pour retrait' : 'â†‘ Aucun dÃ©pÃ´t encore');
  $s('big-gains',  fmtF(p.gains_totaux));
  $s('big-invest', fmtF(p.investissement));
  $s('big-tasks',  tasksDone);

  // TrÃ©sor
  $s('t-tresor', fmtF(p.investissement));
  $s('t-benef',  fmtF(p.benefices_jour));

  // Stats 9 cases
  $s('s-hier',   fmtF(p.gains_hier));
  $s('s-jour',   fmtF(p.gains_jour));
  $s('s-total',  fmtF(p.gains_totaux));
  $s('s-sem',    fmtF(p.gains_semaine));
  $s('s-mois',   fmtF(p.gains_mois));
  $s('s-tok',    tasksDone);
  $s('s-trest',  rest);
  $s('s-rabais', fmtF(p.rabais_commission));
  $s('s-commis', fmtF(p.commission_parrainage));
}

async function init(){
  const{data:{user}}=await SB.auth.getUser();
  if(!user){window.location.href='index.html';return}

  const name=user.user_metadata?.full_name||user.email?.split('@')[0]||'Investisseur';
  const phone=user.user_metadata?.phone||user.email||'â€”';
  $s('u-phone', phone);
  $s('u-name', name);

  // Avatar initiales
  const ini=(name.split(' ').map(w=>w[0]||'').join('').toUpperCase()||'VG').slice(0,2);
  $s('av-ini', ini);
  const avImg=document.getElementById('av-img');
  avImg.src=`https://ui-avatars.com/api/?name=${encodeURIComponent(ini)}&background=15803D&color=fff&size=100&bold=true`;
  avImg.style.display='block';
  document.getElementById('av-ini').style.display='none';

  // Charger / crÃ©er profil
  const p=await getOrCreateProfile(user);

  // Compter tÃ¢ches faites aujourd'hui
  const today=new Date().toISOString().slice(0,10);
  const{data:tc}=await SB.from('taches_completees')
    .select('id').eq('user_id',user.id).eq('type_tache','stage').eq('date_jour',today);
  const tasksDone=Math.min((tc||[]).length, MAX);

  // Afficher tout
  displayProfile(p, tasksDone);
}

init();
</script>
</body>
</html>
