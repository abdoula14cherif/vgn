<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<title>VGN ‚Äì Inviter</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
:root{--g:#16A34A;--gd:#15803D;--gl:#22C55E;--o:#F97316;--od:#EA580C;--bg:#F1F5F1;--card:#fff;--txt:#111827;--mu:#6B7280;--bd:#E5E7EB;--H:56px;--B:58px;--sat:env(safe-area-inset-top,0px);--sab:env(safe-area-inset-bottom,0px)}
html{font-family:'Nunito',sans-serif;background:var(--bg)}
body{max-width:430px;margin:0 auto;background:var(--bg);overflow-x:hidden}
.topbar{position:fixed;top:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:calc(var(--H) + var(--sat));background:linear-gradient(135deg,var(--gd),var(--gl));display:flex;align-items:center;justify-content:space-between;padding:var(--sat) 14px 0;z-index:999;box-shadow:0 2px 10px rgba(0,0,0,.15)}
.tbk{width:34px;height:34px;border-radius:50%;background:rgba(255,255,255,.2);border:1px solid rgba(255,255,255,.3);display:flex;align-items:center;justify-content:center;font-size:1.2rem;cursor:pointer;text-decoration:none;color:#fff;font-weight:900}
.tbt{font-size:1rem;font-weight:900;color:#fff}
.tbp{font-size:.67rem;font-weight:800;color:#fff;background:rgba(255,255,255,.18);padding:4px 10px;border-radius:16px;border:1px solid rgba(255,255,255,.28)}
.scroll{padding-top:calc(var(--H) + var(--sat) + 12px);padding-bottom:calc(var(--B) + var(--sab) + 24px);min-height:100svh}
.botnav{position:fixed;bottom:0;left:50%;transform:translateX(-50%);width:100%;max-width:430px;height:calc(var(--B) + var(--sab));padding-bottom:var(--sab);background:#fff;border-top:1px solid var(--bd);display:flex;align-items:center;z-index:999;box-shadow:0 -2px 10px rgba(0,0,0,.07)}
.bn{display:flex;flex-direction:column;align-items:center;gap:2px;flex:1;padding:6px 0;text-decoration:none}
.bni{font-size:1.2rem}.bnl{font-size:.57rem;font-weight:800;color:var(--mu)}

/* HERO */
.hero{margin:0 12px 14px;background:linear-gradient(135deg,var(--o),var(--od));border-radius:20px;padding:18px 18px 16px;position:relative;overflow:hidden;box-shadow:0 6px 24px rgba(249,115,22,.28)}
.hero::before{content:'üë•';position:absolute;right:-12px;top:-12px;font-size:6rem;opacity:.1}
.hero h2{font-size:1.05rem;font-weight:900;color:#fff;margin-bottom:5px}
.hero p{font-size:.73rem;color:rgba(255,255,255,.88);line-height:1.55;margin-bottom:14px}
.hero-stats{display:flex;gap:8px}
.hst{flex:1;background:rgba(255,255,255,.18);border-radius:12px;padding:9px 8px;text-align:center;border:1px solid rgba(255,255,255,.22)}
.hst-v{font-size:1.05rem;font-weight:900;color:#fff}
.hst-l{font-size:.57rem;color:rgba(255,255,255,.75);font-weight:700;margin-top:2px}

/* CARD */
.card{margin:0 12px 14px;background:var(--card);border-radius:18px;padding:15px 16px;box-shadow:0 1px 8px rgba(0,0,0,.07)}
.card h3{font-size:.86rem;font-weight:900;color:var(--txt);margin-bottom:12px;display:flex;align-items:center;gap:7px}

/* CODE BOX */
.code-box{background:#F0FDF4;border:2px dashed var(--g);border-radius:14px;padding:14px 12px;text-align:center;margin-bottom:10px;cursor:pointer;transition:background .15s;user-select:none}
.code-box:active{background:#DCFCE7}
.code-lbl{font-size:.61rem;color:var(--mu);font-weight:700;margin-bottom:5px}
.code-val{font-size:1.6rem;font-weight:900;color:var(--g);letter-spacing:.15em;font-family:'Courier New',monospace}
.code-hint{font-size:.6rem;color:var(--mu);margin-top:5px}

/* LIEN BOX */
.link-box{background:#EFF6FF;border:2px solid #BFDBFE;border-radius:14px;padding:12px 13px;margin-bottom:10px}
.link-lbl{font-size:.61rem;font-weight:700;color:#1E40AF;margin-bottom:6px;text-transform:uppercase;letter-spacing:.04em}
.link-url{font-size:.72rem;font-weight:700;color:#1D4ED8;word-break:break-all;line-height:1.4;font-family:'Courier New',monospace;background:#fff;border-radius:9px;padding:8px 10px;border:1px solid #BFDBFE;margin-bottom:8px}
.link-copy{display:flex;align-items:center;justify-content:center;gap:7px;width:100%;padding:9px;background:#1D4ED8;border:none;border-radius:10px;font-family:'Nunito',sans-serif;font-size:.74rem;font-weight:800;color:#fff;cursor:pointer}
.link-copy:active{opacity:.85}

/* SHARE GRID */
.share-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:10px}
.sbtn{display:flex;align-items:center;justify-content:center;gap:7px;padding:11px;border-radius:12px;font-family:'Nunito',sans-serif;font-size:.77rem;font-weight:800;cursor:pointer;border:none;transition:transform .15s}
.sbtn:active{transform:scale(.95)}
.sb-copy{background:#F0FDF4;color:var(--g);border:1.5px solid var(--g)}
.sb-wa{background:#25D366;color:#fff}
.sb-tg{background:#229ED9;color:#fff}
.sb-sms{background:#F3F4F6;color:var(--txt);border:1.5px solid var(--bd)}
.sb-share{background:linear-gradient(135deg,var(--o),var(--od));color:#fff;grid-column:1/-1}

/* HOW */
.step{display:flex;align-items:flex-start;gap:11px;margin-bottom:11px}
.step:last-child{margin-bottom:0}
.snum{width:30px;height:30px;border-radius:9px;display:flex;align-items:center;justify-content:center;font-size:.9rem;font-weight:900;flex-shrink:0}
.s1{background:#FEF3C7;color:#92400E}.s2{background:#DCFCE7;color:#14532D}.s3{background:#DBEAFE;color:#1E3A8A}
.stxt h4{font-size:.77rem;font-weight:800;color:var(--txt);margin-bottom:2px}
.stxt p{font-size:.66rem;color:var(--mu);line-height:1.4}

/* COMMISSIONS */
.comm-card{margin:0 12px 14px;background:linear-gradient(135deg,var(--gd),var(--gl));border-radius:18px;padding:15px 18px;box-shadow:0 4px 16px rgba(22,163,74,.25)}
.comm-card h3{font-size:.86rem;font-weight:900;color:rgba(255,255,255,.9);margin-bottom:11px}
.comm-row{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.12);border-radius:11px;padding:10px 13px;margin-bottom:7px;border:1px solid rgba(255,255,255,.15)}
.comm-row:last-child{margin-bottom:0}
.cl{font-size:.7rem;color:rgba(255,255,255,.8);font-weight:700}
.cv{font-size:.86rem;font-weight:900;color:#fff}

/* FILLEULS */
.fil-list{padding:0 12px;display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
.fitem{background:var(--card);border-radius:14px;padding:12px 14px;display:flex;align-items:center;gap:11px;box-shadow:0 1px 6px rgba(0,0,0,.06)}
.fav{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,var(--g),var(--gd));display:flex;align-items:center;justify-content:center;font-size:.95rem;font-weight:900;color:#fff;flex-shrink:0}
.finfo{flex:1;min-width:0}
.fnom{font-size:.77rem;font-weight:800;color:var(--txt);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.fdate{font-size:.61rem;color:var(--mu);margin-top:2px}
.fright{text-align:right;flex-shrink:0}
.fgain{font-size:.82rem;font-weight:900;color:var(--g)}
.fbadge{font-size:.58rem;font-weight:700;padding:2px 8px;border-radius:10px;margin-top:3px;display:inline-block;background:#F0FDF4;color:var(--g)}
.vide{text-align:center;padding:28px 16px}
.vide-ico{font-size:2.8rem;margin-bottom:10px}
.vide-t{font-size:.82rem;font-weight:800;color:var(--txt);margin-bottom:4px}
.vide-s{font-size:.7rem;color:var(--mu)}
.sec-h{padding:0 14px;margin-bottom:9px;font-size:.85rem;font-weight:900;color:var(--txt)}
.tst{position:fixed;top:calc(var(--H) + var(--sat) + 8px);left:50%;transform:translateX(-50%) translateY(-80px);background:#111;color:#fff;padding:9px 22px;border-radius:22px;font-size:.77rem;font-weight:700;z-index:99999;white-space:nowrap;transition:transform .3s cubic-bezier(.34,1.56,.64,1);pointer-events:none;box-shadow:0 4px 16px rgba(0,0,0,.2)}
.tst.show{transform:translateX(-50%) translateY(0)}.tst.err{background:#DC2626}.tst.ok{background:var(--g)}
.ld{display:inline-block;width:10px;height:10px;border:2px solid #ccc;border-top-color:var(--g);border-radius:50%;animation:sp .6s linear infinite;vertical-align:middle}
@keyframes sp{to{transform:rotate(360deg)}}
</style>
</head>
<body>
<div class="topbar">
  <a class="tbk" href="profil.html">‚Äπ</a>
  <span class="tbt">üë• Inviter des amis</span>
  <div class="tbp">üí∞ <span id="tb-solde">‚Äî</span></div>
</div>
<div class="tst" id="tst"></div>

<div class="scroll">

  <!-- HERO -->
  <div class="hero">
    <h2>üí∏ Gagnez 10% sur chaque filleul !</h2>
    <p>√Ä chaque gain r√©alis√© par votre filleul, vous recevez automatiquement <b>10%</b> cr√©dit√© sur votre solde ‚Äî sans limite ni expiration !</p>
    <div class="hero-stats">
      <div class="hst"><div class="hst-v" id="nb-filleuls"><span class="ld"></span></div><div class="hst-l">Filleuls</div></div>
      <div class="hst"><div class="hst-v" id="tot-commis"><span class="ld"></span></div><div class="hst-l">Commissions</div></div>
      <div class="hst"><div class="hst-v">10%</div><div class="hst-l">Taux fixe</div></div>
    </div>
  </div>

  <!-- CODE + LIEN -->
  <div class="card">
    <h3>üéüÔ∏è Mon code de parrainage</h3>
    <div class="code-box" onclick="copierCode()">
      <div class="code-lbl">Appuyez pour copier le code</div>
      <div class="code-val" id="code-val"><span class="ld"></span></div>
      <div class="code-hint">üìã Partagez ce code √† vos amis</div>
    </div>

    <!-- LIEN COMPLET -->
    <div class="link-box">
      <div class="link-lbl">üîó Mon lien d'invitation complet</div>
      <div class="link-url" id="link-url">Chargement...</div>
      <button class="link-copy" onclick="copierLien()">üìã Copier le lien complet</button>
    </div>

    <!-- BOUTONS PARTAGE -->
    <div class="share-grid">
      <button class="sbtn sb-wa"  onclick="shareWA()">üü¢ WhatsApp</button>
      <button class="sbtn sb-tg"  onclick="shareTG()">‚úàÔ∏è Telegram</button>
      <button class="sbtn sb-sms" onclick="shareSMS()">üí¨ SMS</button>
      <button class="sbtn sb-copy" onclick="copierCode()">üìã Copier code</button>
      <button class="sbtn sb-share" onclick="shareNatif()">üì§ Partager via...</button>
    </div>
  </div>

  <!-- COMMENT √áA MARCHE -->
  <div class="card">
    <h3>üìñ Comment √ßa marche</h3>
    <div class="step">
      <div class="snum s1">1</div>
      <div class="stxt"><h4>Partagez votre code ou lien</h4><p>Envoyez votre code unique ou lien direct par WhatsApp, Telegram ou SMS.</p></div>
    </div>
    <div class="step">
      <div class="snum s2">2</div>
      <div class="stxt"><h4>Votre ami s'inscrit</h4><p>Il entre votre code ou clique sur votre lien lors de l'inscription sur VGN.</p></div>
    </div>
    <div class="step">
      <div class="snum s3">3</div>
      <div class="stxt"><h4>Vous gagnez 10% √† vie</h4><p>Sur <b>chaque gain</b> de votre filleul (t√¢ches, roue, investissement), 10% vous sont cr√©dit√©s automatiquement.</p></div>
    </div>
  </div>

  <!-- COMMISSIONS -->
  <div class="comm-card">
    <h3>üí∞ Mes commissions de parrainage</h3>
    <div class="comm-row"><span class="cl">Commission totale re√ßue</span><span class="cv" id="c-total">‚Äî</span></div>
    <div class="comm-row"><span class="cl">Nombre de filleuls actifs</span><span class="cv" id="c-nb">‚Äî</span></div>
    <div class="comm-row"><span class="cl">Taux de commission</span><span class="cv">10% par gain filleul</span></div>
    <div class="comm-row"><span class="cl">Versement</span><span class="cv">Automatique & instantan√©</span></div>
  </div>

  <!-- FILLEULS -->
  <div class="sec-h">üë• Mes filleuls (<span id="nb-f2">0</span>)</div>
  <div class="fil-list" id="fil-list">
    <div style="text-align:center;padding:20px"><span class="ld"></span></div>
  </div>

</div>

<nav class="botnav">
  <a class="bn" href="dashboard.html"><span class="bni">üè†</span><span class="bnl">Accueil</span></a>
  <a class="bn" href="taches.html"><span class="bni">‚úÖ</span><span class="bnl">T√¢ches</span></a>
  <a class="bn" href="rapport.html"><span class="bni">üìä</span><span class="bnl">Rapports</span></a>
  <a class="bn" href="profil.html"><span class="bni">üë§</span><span class="bnl">Mon Compte</span></a>
</nav>

<script>
const SB=supabase.createClient('https://tgrfzybemuwvhkbpuzmz.supabase.co','eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRncmZ6eWJlbXV3dmhrYnB1em16Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxMDMwOTgsImV4cCI6MjA4NzY3OTA5OH0.M20AwabfyHK_btwhgCmdUUbP2IAtY4TeYbc3Ovzj7CE',{auth:{persistSession:true,storageKey:'vgn-auth',storage:window.localStorage}});
const fmt=n=>Number(n||0).toLocaleString('fr-FR');
const fmtF=n=>fmt(n)+' FCFA';
const $=id=>document.getElementById(id);
const $s=(id,v)=>{const e=$(id);if(e)e.textContent=v};
const toast=(m,t='')=>{const el=$('tst');el.textContent=m;el.className='tst show'+(t?' '+t:'');setTimeout(()=>el.className='tst',3500)};
let U=null,P=null,monCode='',monLien='';
const BASE_URL='https://vgn-two.vercel.app';

function getLien(){return `${BASE_URL}/index.html?ref=${monCode}`}
function msgComplet(){return `üå± Rejoignez VGN Agriculture et gagnez de l'argent facilement !\n\nüéüÔ∏è Code de parrainage : *${monCode}*\nüîó Lien direct : ${monLien}\n\n‚úÖ Compl√©tez des t√¢ches et gagnez d√®s le 1er jour !`}
function msgCourt(){return `Rejoignez VGN Agriculture ! Mon lien : ${monLien}`}

function copier(txt,msg){
  const fb=()=>{const t=document.createElement('textarea');t.value=txt;document.body.appendChild(t);t.select();document.execCommand('copy');document.body.removeChild(t);toast('‚úÖ '+msg,'ok')};
  if(navigator.clipboard)navigator.clipboard.writeText(txt).then(()=>toast('‚úÖ '+msg,'ok')).catch(fb);else fb();
}
function copierCode(){copier(monCode,'Code copi√© !')}
function copierLien(){copier(monLien,'Lien copi√© !')}
function shareWA(){window.open('https://wa.me/?text='+encodeURIComponent(msgComplet()),'_blank')}
function shareTG(){window.open('https://t.me/share/url?url='+encodeURIComponent(monLien)+'&text='+encodeURIComponent('üå± Rejoignez VGN Agriculture ! Code parrainage : '+monCode),'_blank')}
function shareSMS(){window.open('sms:?body='+encodeURIComponent(msgCourt()),'_blank')}
async function shareNatif(){
  if(navigator.share){
    try{await navigator.share({title:'VGN Agriculture ‚Äì Parrainage',text:msgComplet(),url:monLien})}
    catch(e){}
  }else{
    copierLien();
  }
}

async function chargerFilleuls(){
  if(!monCode)return;
  const{data:fils}=await SB.from('profiles').select('id,full_name,email,created_at,gains_totaux').eq('code_parrain',monCode).order('created_at',{ascending:false});
  const nb=(fils||[]).length;
  const totalCommis=P?.commission_parrainage||0;
  $s('nb-filleuls',nb);$s('nb-f2',nb);
  $s('tot-commis',fmtF(totalCommis));
  $s('c-total',fmtF(totalCommis));$s('c-nb',nb);
  const list=$('fil-list');
  if(!nb){list.innerHTML=`<div class="vide"><div class="vide-ico">üë•</div><div class="vide-t">Aucun filleul pour l'instant</div><div class="vide-s">Partagez votre code ou lien pour commencer √† gagner</div></div>`;return}
  list.innerHTML=fils.map(f=>{
    const ini=(f.full_name||f.email||'?')[0].toUpperCase();
    const d=new Date(f.created_at).toLocaleDateString('fr-FR',{day:'2-digit',month:'short',year:'numeric'});
    const g=f.gains_totaux||0;
    const comm=Math.floor(g*0.1);
    return `<div class="fitem">
      <div class="fav">${ini}</div>
      <div class="finfo">
        <div class="fnom">${f.full_name||f.email||'‚Äî'}</div>
        <div class="fdate">Inscrit le ${d}</div>
      </div>
      <div class="fright">
        <div class="fgain">+${fmtF(comm)}</div>
        <span class="fbadge">Ma commission</span>
      </div>
    </div>`;
  }).join('');
}

async function init(){
  const{data:{session}}=await SB.auth.getSession();
  if(!session){window.location.href='index.html';return}
  U=session.user;
  const{data:p}=await SB.from('profiles').select('*').eq('id',U.id).single();
  P=p||{solde:0,code_parrainage:null,commission_parrainage:0};
  $s('tb-solde',fmtF(P.solde||0));
  monCode=P.code_parrainage||(U.id.slice(0,8).toUpperCase());
  monLien=getLien();
  $s('code-val',monCode);
  $('link-url').textContent=monLien;
  await chargerFilleuls();
}
init();
</script>
</body>
</html>
